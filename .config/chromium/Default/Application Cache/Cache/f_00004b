define("HubsExtension/ArmHelpers/ArmApis",["require","exports","f"],(function(n,t,i){"use strict";var r;return (function(n){function o(n){return n.replace(b,"")}function t(n){return"/"+o(n)}function s(n){return n.replaceAll("'","''")}function k(n){return"/subscriptions/"+n+v}function d(n){return"/subscriptions/"+n+"/tagnames?$expand=tagvalues"+y}function g(n){return n?"/subscriptions/"+n+"/providers"+r:"/providers"+r}function nt(n){var t="?$expand=metadata"+p;return n?"/subscriptions/"+n+"/providers"+t:"/providers"+t}function tt(n){return"/providers/"+n+r}function it(n,t){return"/subscriptions/"+n+"/providers/"+t+"/register"+r}function rt(n,t){return"/subscriptions/"+n+"/providers/"+t+"/unregister"+r}function ut(n,t){return"/subscriptions/"+n+"/providers/"+t+r}function ft(n,t,i){return"/subscriptions/"+n+"/resourcegroups/"+t+"/deployments/"+i}function et(n){return t(n)+"/deployments"+e}function ot(n){return t(n)+a}function st(n,i){return t(n)+("/providers/microsoft.resources/deployments/"+
i+"/validate")+a}function ht(n){return t(n)+"/cancel"+e}function ct(n){return t(n)+"/operations"+e}function lt(n){return t(n)+e}function at(n){return"/subscriptions/"+n+"/resourcegroups"+r}function vt(n){return n+"/providers/Microsoft.Authorization/locks"+u}function yt(n,t){return n+"/providers/Microsoft.Authorization/locks/"+t+u}function pt(n){return t(n)+u}function wt(n,t){var i="/subscriptions/"+o(n)+"/resources"+r;return t&&(i=i+"&$top=1"),i}function bt(n){var t=new h.UriBuilder("/subscriptions/"+n+"/resources"),i=w.map((function(n){return"resourceType eq '"+n+"'"})).join(" or ");return t.query.setParameter("$filter",i),t.toString()+f}function kt(n,t,i){var r=new h.UriBuilder("/subscriptions/"+n+"/resourcegroups"),u=["tagname eq '"+s(t)+"'",i?"tagvalue eq '"+s(i)+"'":null,].filter((function(n){return!!n})).join(" and ");return r.query.setParameter("$filter",u),r.toString()+f}function dt(n,t,i){var r=new h.UriBuilder("/subscriptions/"+n+"/resources"),u=["tagname eq '"+s(t)+"'",i?"tagvalue eq '"+
s(i)+"'":null,].filter((function(n){return!!n})).join(" and ");return r.query.setParameter("$filter",u),r.toString()+f}function gt(n){return t(n)+"/moveresources"+u}function ni(n){return t(n)+"/validateMoveResources"+u}function ti(n){return t(n)+"/providers/Microsoft.ClassicCompute/validateSubscriptionMoveAvailability"+l}function ii(n){return"/subscriptions/"+o(n)+"/providers/Microsoft.ClassicCompute/moveSubscriptionResources"+l}function ri(n,t){return"/subscriptions/"+n+"/resourcegroups/"+t+"/resources"+r}function ui(n,t){return"/subscriptions/"+n+"/resources?$filter=tagname%20eq%20'hidden-link:"+t+"'"+f}function fi(n){return t(n)+"/providers/Microsoft.Resources/links"+u}function ei(n){n=o(n);var t="/"+n,i=(c.isResourceGroupId(t)?c.parseResourceGroupDescriptor(t):c.parseResourceDescriptor(t)).subscription;return"/subscriptions/"+i+"/providers/Microsoft.Resources/links"+u+("&$filter=targetId eq '"+n+"'")}function oi(n,t){if(typeof n!="string"){var i=n;n="/subscriptions/"+i.subscriptionId+
"/resourcegroups/"+i.resourceGroupName+"/providers/Microsoft.Portal/dashboards/"+i.dashboardName}return n+"?api-version="+t}function si(n){var t=n.map((function(n){return"subscriptionId eq '"+n+"'"})).join(" or ");return"/resources?$filter=("+t+") and (resourceType eq 'Microsoft.Portal/dashboards')"+f}var h=i.Base,c=i.ViewModels.Services.ResourceTypes,r="?api-version=2014-04-01-preview",f="&api-version=2014-04-01-preview",u="?api-version=2015-01-01",l="?api-version=2015-10-01",e="?api-version=2015-11-01",v="?api-version=2016-06-01",a="?api-version=2017-05-10",y="&api-version=2016-06-01",p="&api-version=2016-02-01",w=["Microsoft.ClassicCompute/virtualMachines","Microsoft.ClassicCompute/domainNames","Microsoft.ClassicStorage/storageAccounts","Microsoft.ClassicNetwork/virtualNetworks","Microsoft.ClassicNetwork/reservedIps"],b=/^[\s\/\/]*|[\/\/]*$/g;n.getSubscriptionApi=k;n.subscriptionTagsApi=d;n.listResourceProvidersApi=g;n.listResourceProvidersWithMetadataApi=nt;n.getResourceProviderApi=tt;
n.registerResourceProvidersApi=it;n.unregisterResourceProvidersApi=rt;n.getResourceProviderWithSubscriptionApi=ut;n.buildDeploymentUri=ft;n.listDeploymentsApi=et;n.singleDeploymentApi=ot;n.validateDeploymentApi=st;n.cancelDeploymentApi=ht;n.deploymentOperationsApi=ct;n.singleDeploymentOperationApi=lt;n.resourceGroupsInSubscriptionApi=at;n.locksOnResourceApi=vt;n.createLockOnResourceApi=yt;n.deleteLockOnResourceApi=pt;n.resourcesInSubscriptionApi=wt;n.classicResourcesInSubscriptionApi=bt;n.resourceGroupsWithTag=kt;n.resourcesWithTag=dt;n.moveResourcesApi=gt;n.validateMoveResourcesApi=ni;n.validateSubscriptionMoveAvailabilityApi=ti;n.moveResourcesToSubscriptionApi=ii;n.resourcesInResourceGroupByNameApi=ri;n.resourcesLinkedToResourceApi=ui;n.linksOfScopeApi=fi;n.linksToScopeApi=ei;n.dashboardApi=oi;n.allDashboardsApi=si})(r||(r={})),r}));define("HubsExtension/Tags/TagsArea",["require","exports","f","i","ko","HubsExtension/Tags/TagsClientStrings","HubsExtension/_generated/ExtensionDefinition",
"HubsExtension/ArmHelpers/ArmApis","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResource","HubsExtension/ArmHelpers/Models/ArmResourceGroup","HubsExtension/HubsCommon","HubsExtension/ResourceMap/ResourceMapCommon"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";var v;return (function(n){function t(n){return n&&n.toLowerCase()}function ht(n){var t=n.indexOf("?");return t>0&&(n=n.substring(0,t)),n}function ct(n,t,i,r,u){return g.getAllTagsForSubscriptions(u.subscriptions,u.cloudName)}function lt(n,t){var i=[];return s.callBatchWithContinuation(n,(function(n){i=i.concat(n)}),(function(n){throw n;}),!1,t,v("Tags.allTags"),!0).then((function(){return i}))}function at(n,t,i,r,f){return f.resourceId?s.resourceApi(f.resourceId,f.cloudName).then((function(t){return s.call(t,n,undefined,f.cloudName,v("Tags.resourceForTags"),!1).then((function(n){var t=[];return n&&n.tags&&(t=et(n.tags,f.resourceId,f.cloudName)),{tags:u.observableArray(t)}}),(function(n){return k("Error getting tags for resource id {0}. Error: {1}".
format(f.resourceId,n.responseText)),Q.reject()}))})):Q()}function vt(n,t,i,r,u){var f=[],e=u.subscriptions.map((function(n){var t=o.resourceGroupsWithTag(n,u.tagName,u.tagValue);return yt(t,u.cloudName).then((function(n){f=f.concat(n.map((function(n){return n.id})))}))}));return e=e.concat(u.subscriptions.map((function(n){var t=o.resourcesWithTag(n,u.tagName,u.tagValue);return pt(t,u.cloudName).then((function(n){f=f.concat(n.map((function(n){return n.id})))}))}))),Q.allSettled(e).then((function(n){var t=n.some((function(n){return n.state===ot}));return t&&k("There was an error getting some resources for one or more subscriptions."),f}),(function(n){return k("Error getting tags for subscriptions. Error: {0}".format(n.responseText)),f}))}function yt(n,t){var i=[];return s.callWithContinuation([n],(function(n){var t=n.map(c.toResourceGroup).filter((function(n){return!!n}));i=i.concat(t)}),(function(n){throw n;}),t,v("Tags.resourceGroups")).then((function(){return i}))}function pt(n,t){var i=[];return s.callWithContinuation(
[n],(function(n){var t=n.map(h.toResource).filter((function(n){return!!n}));i=i.concat(t)}),(function(n){throw n;}),t,v("Tags.resources")).then((function(){return i}))}function ft(n,t){return!s.isHiddenTag(n)&&(!!t||l.tagsV2Enabled)}function et(t,i,r){var h=[],f,o,s;for(f in t)o=t[f],ft(f,o)&&(s={key:u.observable(f),value:u.observable(o),compound:u.observable(n.compoundFormat.format(f,o)),commandGroup:u.observable(e.CommandGroupNames.tagItemCommandGroup),allowEdits:u.observable(undefined),resourceId:u.observable(i)},w.addToModel(r,s),h.push(s));return h.sort(b)}function b(n,t){var i=n.key().localeCompare(t.key());return i?i:n.value().localeCompare(t.value())}function y(n){tt.Log.writeEntry(2,"HubsExtension.Tags",n)}function k(n){tt.Log.writeEntry(1,"HubsExtension.Tags",n)}function d(n,t,r,u,f){var e=!ut&&f&&parseInt(f),o=Q.delay(e&&!isNaN(e)?e*1e3:st);return i.tryImmediateResolve(o,(function(){return Q(s.callRaw({armApiOrUri:t,httpMethod:"GET",cloudName:u,telemetry:v("Tags.startPolling")})).then(
(function(i){var f=i.jqXHR,e;return f.status!==204&&f.status!==200?d(n,t,r,u,f.getResponseHeader("retry-after")):(e=v("TagsPatch.getResource"),rt.isResourceId(n))?a.ResourceClient.getResource(n,u,e,!0).then((function(n){return n.tags})):rt.isResourceGroupId(n)?a.ResourceGroupClient.getResourceGroup(n,u,e,!0).then((function(n){return n.tags})):Q.reject("Expected a resource or resource group ID")}))}))}var nt=i.Base,tt=nt.Diagnostics,p=r.Extension,w=p.CloudName,it=i.Hubs.Notifications,rt=i.ViewModels.Services.ResourceTypes,g;n.compoundFormat="{0} : {1}";n.compoundPendingAddingFormat="{0} {1}".format(n.compoundFormat,f.compoundPendingAddingFormat);n.compoundPendingDeletingFormat="{0} {1}".format(n.compoundFormat,f.compoundPendingDeletingFormat);n.tagsAreaName="Tags";var ot=nt.Promises.PromiseStates.rejected,v=s.makeResourceManagerTelemetry,ut=i.isFeatureEnabled("fasttagpolling"),st=ut?200:5e3;n.GetResourceIdWithoutApiVersion=ht;n.startPolling=d;g=(function(){function h(){var n="HubsExtension.TypeMetadata.Tags.TagItem",
r="HubsExtension.TypeMetadata.Tags.ResourceTags",t="HubsExtension.TypeMetadata.Tags.ResourceItem";i.Data.Metadata.getTypeMetadata(n)||i.Data.Metadata.setTypeMetadata(n,{properties:{key:null,value:null,compound:null,commandGroup:null,allowEdits:null,resourceId:null},entityType:!0});i.Data.Metadata.getTypeMetadata(r)||i.Data.Metadata.setTypeMetadata(r,{properties:{tags:{itemType:n,isArray:!0}},entityType:!0});i.Data.Metadata.getTypeMetadata(t)||i.Data.Metadata.setTypeMetadata(t,{name:t});this.subscriptionTagsCache=new i.Data.QueryCache({httpMethod:"GET",serializeParams:function(n){return JSON.stringify([n.subscriptions,p.normalizeCloudName(n.cloudName)])},supplyData:ct,entityTypeName:n,extendEntryLifetimes:!0});this.resourceTagsCache=new i.Data.EntityCache({httpMethod:"GET",serializeParams:function(n){return JSON.stringify([n.resourceId,p.normalizeCloudName(n.cloudName)])},supplyData:at,entityTypeName:r});this.resourcesWithTagQueryCache=new i.Data.QueryCache({httpMethod:"GET",serializeParams:
function(n){return JSON.stringify([n.subscriptions,n.tagName,n.tagValue,p.normalizeCloudName(n.cloudName)])},supplyData:vt,entityTypeName:t})}return h.prototype.addTagToSubscriptionTagsCache=function(i,r,f){var e=t(i),o=t(r);this.subscriptionTagsCache.applyChanges((function(s,h){var c,l;h.data&&h.data()&&(c=h.data().first((function(n){return t(n.key())===e&&t(n.value())===o})),c||(l={key:u.observable(i),value:u.observable(r),cloudName:u.observable(f),compound:u.observable(n.compoundFormat.format(i,r)),allowEdits:u.observable(!1),resourceId:u.observable(null)},h.addItems(0,[l],null,!1,h.data)))}))},h.prototype.addNewTag=function(i,r,f,o){var h=this,s;return(i||y("Can't save tag. Missing tag key."),r||y("Can't save tag. Missing tag value."),f||y("Can't save tag. Missing resource id."),!i||!r||!f)?(s=Q.defer(),s.reject(),s.promise):this._getLatestSetAndPatchTags(f,(function(){var t;return h.resourceTagsCache.applyChanges((function(s,h){var c={key:u.observable(i),value:u.observable(r),compound:u.
observable(n.compoundPendingAddingFormat.format(i,r)),commandGroup:u.observable(e.CommandGroupNames.tagItemCommandGroup),allowEdits:u.observable(!1),resourceId:u.observable(f)};w.addToModel(o,c);t=h.data().tags().slice(0);h.addItems(0,[c],null,!1,h.data().tags);h.data().tags(h.data().tags().sort(b))}),(function(n){return n.resourceId===f})),t}),(function(n){var u={};for(var f in n)t(i)!==t(f)&&(u[f]=n[f]);return u[i]=r,u}),o,{key:u.observable(i),value:u.observable(r),compound:u.observable(n.compoundFormat.format(i,r)),allowEdits:u.observable(!1),resourceId:u.observable(null)})},h.prototype.deleteTag=function(t,i,r,u){var e=this,f;return(t||y("Can't delete tag. Missing tag key."),i||y("Can't delete tag. Missing tag value."),r||y("Can't delete tag. Missing resource id."),!t||!i||!r)?(f=Q.defer(),f.reject(),f.promise):this._getLatestSetAndPatchTags(r,(function(){var u;return e.resourceTagsCache.applyChanges((function(r,f){var e=f.data().tags().first((function(n){return n.key()===t&&n.value()===i}));
u=f.data().tags().slice(0);e&&(e.compound(n.compoundPendingDeletingFormat.format(t,i)),e.allowEdits(!1))}),(function(n){return n.resourceId===r})),u}),(function(n){var f={},r,u;for(r in n)u=n[r],r===t&&u===i||(f[r]=u);return f}),u)},h.getAllTagsForSubscriptions=function(t,i){var r=[],f=t.map((function(n){return o.subscriptionTagsApi(n)}));return lt(f,i).then((function(t){return t.forEach((function(t){t.values&&t.values.forEach((function(f){if(ft(t.tagName,f.tagValue)){var e={key:u.observable(t.tagName),cloudName:u.observable(i),value:u.observable(f.tagValue),compound:u.observable(n.compoundFormat.format(t.tagName,f.tagValue)),allowEdits:u.observable(!1),resourceId:u.observable(null)};w.addToModel(i,e);r.push(e)}}))})),r=r.sort(b)}))},h.prototype._getLatestSetAndPatchTags=function(i,e,o,h,c){var l=this;return s.resourceApi(i,h).then((function(a){var p=e();return s.call(a,"GET",undefined,h,v("Tags.resourcesForPatch"),!1).then((function(r){var e=o(r.tags);return s.callRaw({armApiOrUri:a,httpMethod:"PATCH",
data:u.toJSON({tags:e}),cloudName:h,telemetry:v("Tags.patchTags"),useApiInvoke:!1}).then((function(r){var u=r.jqXHR,e=u.getResponseHeader("Location"),o=e?d(i,e,a,h,u.getResponseHeader("retry-after")):Q(r.content.tags);return o.then((function(r){var u=et(r,i,h),e,o;l.resourceTagsCache.applyChanges((function(t,i){var r=i.data().tags().first((function(n){return n.compound().endsWith(f.compoundPendingAddingFormat)})),e=i.data().tags().first((function(n){return n.compound().endsWith(f.compoundPendingDeletingFormat)}));r?(r.compound(n.compoundFormat.format(r.key(),r.value())),r.allowEdits(undefined)):e&&i.removeItem(e,null,i.data().tags);i.data().tags().length!==u.length&&i.data().tags(u)}),(function(n){return n.resourceId===i}));c&&(e=t(c.key()),o=t(c.value()),l.subscriptionTagsCache.applyChanges((function(n,i){if(i.data&&i.data()){var r=i.data().first((function(n){return t(n.key())===e&&n.value()===o}));r||i.addItems(0,[c],null,!1,i.data)}})))}))}))})).catch((function(n){var t=r.Azure.buildSimplifiedError(n&&
n.jqXHR||n);y("Error patching tags: "+r.Diagnostics.getLogFriendlyMessage(t));it.ClientNotification.publish({title:f.errorAddingTags,description:t.message,status:it.NotificationStatus.Error});l.resourceTagsCache.applyChanges((function(n,t){t.data().tags(p)}),(function(n){return n.resourceId===i}))}))})).catch((function(n){y("Error fetching URI for resource id '"+i+"'. Detail: "+r.Diagnostics.getLogFriendlyMessage(n))}))},h})();n.TagsData=g})(v||(v={})),v}));define("HubsExtension/Tags/ViewModels/Parts/ResourceTagsCollectionPart",["require","exports","f","i","ko","HubsExtension/Tags/TagsClientStrings","HubsExtension/Common/HubsObservables","HubsExtension/Tags/TagsArea"],(function(n,t,i,r,u,f,e,o){"use strict";var s;return (function(n){function v(){var n=[{itemKey:"compound",name:u.observable(),activatable:u.observable(!0)}],t={items:u.observableArray([]),columns:u.observableArray(n)},i={selectableRow:{selectionMode:1,activateOnSelection:u.observable(!0)}},r={data:t,showHeader:!1,noRowsMessage:u.observable(
""),selectableRowExtensionOptions:i};return{columns:n,options:r}}var h=i.Base,c=h.Images,l=r.Extension.CloudName,p=i.ViewModels.Controls.Lists.Grid,a=i.ViewModels.Parts,t=i.ViewModels.Services.ResourceTypes,s=f.ResourceTagsCollectionPart,y=(function(n){function i(t,i,r){var f=v();n.call(this,t,f.options);this._columns=f.columns;t.partTitle(s.partTitle);this.resourceId=u.observable();this.rollupCountIcon(c.Tag());this.alwaysShowRollupCount(!0);this._dataContext=r;this._ltm=t.createChildLifetime()}return __extends(i,n),i.prototype.onInputsSet=function(n){var i=this,f=Q.defer(),s;return this.resourceId(n.resourceId||""),this._cloudName=l.readFromInputs(n),n.resourceId?(s=o.GetResourceIdWithoutApiVersion(n.resourceId),r.Security.hasPermission(s,["./read"],this._cloudName).then((function(n){n?(t.isResourceGroupId(s)?i._container.assetName(t.parseResourceGroupDescriptor(s).resourceGroup):t.isResourceId(s)?i._container.assetName(t.parseResourceDescriptor(s).resource):f.reject("Resource ID was not a resource group or resource: "+
t.sanitizeId(s)),i._resourceTagsView||(i._resourceTagsView=i._dataContext.tagsData.resourceTagsCache.createView(i._ltm),u.reactor(i._ltm,(function(){var n=i._resourceTagsView.item();n&&n.tags();i._updateItems()}))),i._resourceTagsView.fetch({resourceId:i.resourceId(),cloudName:i._cloudName}).then((function(){i._updateItems();f.resolve()}),(function(){i._updateItems();f.reject()}))):(i.rollupCount(0),i._container.unauthorized(),f.resolve())}))):e.getSelectedSubscriptions(this._cloudName).then((function(n){n.subscribe(i._container,(function(n){i._populateSubscriptionTags(n,f)}));i._populateSubscriptionTags(n(),f)})),f.promise},i.prototype._updateItems=function(){var n=0;this._options.noRowsMessage(s.noRowsMessage);this.resourceId()?this._resourceTagsView&&this._resourceTagsView.item&&this._resourceTagsView.item()&&this._resourceTagsView.item().tags&&this._resourceTagsView.item().tags()?(n=this._resourceTagsView.item().tags().length,this._options.data.items(this._resourceTagsView.item().tags())):this.
_options.data.items([]):this._subscriptionTagsView&&this._subscriptionTagsView.items&&this._subscriptionTagsView.items()?(n=this._subscriptionTagsView.items().length,this._options.data.items(this._subscriptionTagsView.items())):this._options.data.items([]);this.rollupCount(n)},i.prototype._populateSubscriptionTags=function(n,t){var i=this,r=n.map((function(n){return n.subscriptionId}));this._subscriptionTagsView||(this._subscriptionTagsView=this._dataContext.tagsData.subscriptionTagsCache.createView(this._ltm));this._subscriptionTagsView.fetch({subscriptions:r,cloudName:this._cloudName}).then((function(){i._updateItems();e.getSelectedSubscriptionsLabel(i._cloudName).then((function(n){i._container.assetName(n)}));t.resolve()}),(function(){i._updateItems();t.reject()}))},i})(a.Collection.ViewModel);n.ResourceTagsCollectionPart=y})(s||(s={})),s}))