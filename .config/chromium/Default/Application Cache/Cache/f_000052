define("HubsExtension/ResourceMap/ViewModels/DeploymentDetailsBladeViewModel",["require","exports","f","i","ko","HubsExtension/_generated/ExtensionDefinition","HubsExtension/ResourceMap/ResourceMapClientStrings"],(function(n,t,i,r,u,f,e){"use strict";var o;return (function(n){var s=r.Extension.CloudName,o=i.ViewModels,h=o.Blade,c=o.Services.ResourceTypes,t=i.Azure.ResourceManager.DeploymentStates,l=(function(n){function i(i,r,o){var s=this,h;n.call(this);this.deploymentId=u.observable();this.statusBar=u.observable();this.subtitle(e.deploymentDetailsBladeSubTitle);this._view=o.deploymentEntityCache.createView(i,{interceptNotFound:function(n){var t=c.parseDeploymentDescriptor(n.deploymentId);i.notFound(e.deploymentNotFoundMessage.format(t.deploymentName,t.resourceGroup))}});h=u.computed(i,(function(){var r=s._view.item(),i,u,n;if(r&&(s.title(r.name()),i=r.properties&&r.properties(),i&&(u=i.provisioningState&&i.provisioningState(),u))){n=void 0;switch(u.toLowerCase()){case t.Running:case t.Deploying:
n={state:5,text:e.deploymentRunningState};break;case t.Deleting:n={state:2,text:e.deploymentDeletingState};break;case t.Succeeded:n={state:1,text:e.deploymentSucceededState};break;case t.Failed:n={state:3,text:e.deploymentFailedState};i.error&&i.error()&&(n.text=e.deploymentFailedDetailsState,n.selection={extension:"HubsExtension",detailBlade:f.BladeNames.armErrorsBlade,detailBladeInputs:{errors:i.error},openInContextPane:!0});break;default:n={state:0,text:""}}s.statusBar(n)}}));h.extend({throttle:0})}return __extends(i,n),i.prototype.onInputsSet=function(n){var t=n.deploymentId;if(t)return this._view.fetch({deploymentId:t,cloudName:s.readFromInputs(n)})},i})(h);n.DeploymentDetailsBlade=l})(o||(o={})),o}));define("HubsExtension/ResourceMap/ViewModels/DeploymentDetailsPartViewModel",["require","exports","f","i","ko","HubsExtension/Deployments/DeploymentsCommon","HubsExtension/ResourceMap/ResourceMapClientStrings","MsPortalFx/Globalization","HubsExtension/_generated/ExtensionDefinition","HubsExtension/ArmHelpers/ArmApis",
"HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ResourceMap/ResourceMapCommon"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";var a;return (function(t){var d=i.Base,st=d.Net2,k=r.Extension.CloudName,g=d.Images,y=i.ViewModels,a=y.Parts.Properties,w=y.Services.ResourceTypes,it=y.Dialogs,b=y.Toolbars,v=i.Azure.ResourceManager.DeploymentStates,tt=i.Hubs.Notifications,p=tt.NotificationStatus,rt=window,ut=i.forEachKey,nt=d.Diagnostics.createLog(n),ft=f.getTemplateObject,ht=(function(n){function t(t,r,h){var c=this;n.call(this,r);this._deploymentId=u.observable("");this._deploymentStateLowerCase=u.observable("");this._deploymentTimestamp=u.observable(null);this._deploymentHasTemplateLink=u.observable(!1);this._params=u.observable(null);this._templateUri=u.observable("");this._pollingIntervalInMilliseconds=15e3;this._pollHandle=null;this._container=t;this._context=h;this._initializeToolbar();this._view=h.deploymentEntityCache.createView(t,{interceptNotFound:!0});u.computed(t,(function()
{var h=c._view.item(),b,v;if(h&&h.properties){var n=u.toJS(h.properties()),r=w.parseDeploymentDescriptor(c._deploymentId()),t=[],p=new Date(n.timestamp.toString());c._deploymentStateLowerCase(n.provisioningState.toLowerCase());c._deploymentTimestamp(p);t.push(new a.TextProperty(e.deploymentSummaryDeploymentDateLabel,o.DateTimeFormat.create({day:"numeric",hour:"numeric",minute:"numeric",month:"numeric",second:"numeric",year:"numeric"}).format(p)));t.push(new a.TextProperty(e.deploymentSummaryStatusLabel,l.deploymentStatusDisplayTextLookup[n.provisioningState.toLowerCase()]));n.duration&&t.push(new a.TextProperty(e.deploymentOperationDurationProperty,f.parseISODuration(n.duration)));t.push(new a.TextProperty(e.deploymentCorrelationProperty,n.correlationId));t.push(new a.OpenBladeProperty(e.deploymentResourceGroupLabel,u.observable(r.resourceGroup),u.observable(y.getBladeSelection(undefined,s.BladeNames.resourceMenuBlade,k.addToModel(c._cloudName,{id:w.buildResourceGroupIdFromDescriptor({
resourceGroup:r.resourceGroup,subscription:r.subscription})})))));t.push(new a.OpenBladeProperty(e.deploymentRelatedLabel,u.observable(e.deploymentRelatedEventsLabel),u.observable(y.getBladeSelection("Microsoft_Azure_Insights","ActionDetailsBlade",k.addToModel(c._cloudName,{subscriptionId:r.subscription,eventId:null,correlationId:n.correlationId,timespan:{duration:20160}})))));n.templateLink&&(t.push(new a.LinkProperty(e.deploymentSummaryTemplateLinkLabel,n.templateLink.uri)),c._templateUri(n.templateLink.uri),c._deploymentHasTemplateLink(!0));c.setProperties(t);b=n.parameters||{};v={};i.forEachKey(b,(function(n,t){v[n]=t.value}));c._params(v)}})).extend({throttle:10})}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=n.deploymentId;if(this._deploymentId(t),this._cloudName=k.readFromInputs(n),t)return this._view.fetch({deploymentId:t,cloudName:this._cloudName})},t.prototype._initializeToolbar=function(){this.toolbar=new b.Toolbar(this._container);this.toolbar.setItems([this.
_getDeleteCommand(),this._getCancelCommand(),this._getRefreshCommand(),this._getDeployCommand(),this._getExportCommand()])},t.prototype._getRefreshCommand=function(){var t=this,r=this._container,i=new b.CommandButton,n;return i.label(e.refreshDeployment),i.icon(g.Refresh()),n=u.observable(!1),u.reactor(r,(function(){var i=t._deploymentStateLowerCase();i&&n(i===v.Running||i===v.Deploying||i===v.Accepted)})),i.command={canExecute:n,execute:function(){n(!1);var i={deploymentId:t._deploymentId(),cloudName:t._cloudName},u=t._context;return Q.all([u.deploymentEntityCache.refresh(i,r),u.deploymentOperationsQueryCache.refresh(i,r)]).finally((function(){n(!0)}))}},i},t.prototype._getDeployCommand=function(){var t=this,r=this._container,n=new b.OpenBladeButton;return n.label(e.redeploy),n.icon(d.Images.Release()),n.selectable=new y.Internal.Selectable,n.selectable.isSelected.subscribe(r,(function(r){if(r){var u=t._templateUri(),e=f.loadTemplateFromDeployment(t._deploymentId(),t._cloudName),o=Q(!u?"":
f.loadTemplate(u,t._cloudName));f.launchCreateExperience(n,"Microsoft.Template",s.BladeNames.deploymentDetailsBlade,t._cloudName,Q.all([e,o]).then((function(n){var f=ft(n[0]),e=ft(n[1]),r={inlineParameters:t._params()};return i.deepEquals(f,e)?r.uri=u:r.inlineTemplate=JSON.stringify(f),r})))}})),n.disabled(!0),r.registerSelectable(r,"deploycommand",n.selectable),u.reactor(r,(function(){var i=t._deploymentStateLowerCase(),r=t._deploymentTimestamp(),u=t._deploymentHasTemplateLink()&&r<new Date(2016,2,20);u?(n.label(e.deployNotSupported),n.disabled(!0)):n.disabled(!(i===v.Succeeded||i===v.Failed))})),n},t.prototype._getExportCommand=function(){var t=this,i=this._container,n=new b.OpenBladeButton;return n.label(e.exportTemplate),n.icon(g.Download()),n.disabled(!0),i.registerSelectable(i,"exportcommand",n.selectable),u.reactor(i,(function(){var i=t._deploymentStateLowerCase(),r=t._deploymentTimestamp(),u=t._deploymentHasTemplateLink()&&r<new Date(2016,2,20);u?(n.label(e.exportTemplateNotSupported),
n.disabled(!0)):n.disabled(!(i===v.Succeeded||i===v.Failed))})),u.reactor(i,(function(){n.selectable.selectedValue(y.getBladeSelection(undefined,"TemplateViewerBlade",{options:{deploymentId:t._deploymentId(),parameters:t._params()}}))})),n},t.prototype._getDeleteCommand=function(){var n=this,t=new b.DialogButton,i=u.observable(!1);return t.label(e.deploymentDeleteCommandText),t.icon(g.Delete()),u.reactor(this._container,(function(){var t=n._deploymentStateLowerCase();t&&i(t!==v.Accepted&&t!==v.Running&&t!==v.Deploying&&t!==v.Deleting)})),t.dialogOptions=new it.MessageBox(e.deploymentDeleteCommandConfirmationTitle,e.deploymentDeleteCommandConfirmationMessage,4),t.command={canExecute:i,execute:function(t){if(t===6){var l=n._view.item(),u=l.id(),s=w.parseDeploymentDescriptor(u),f=s.deploymentName,o=s.resourceGroup,r=new tt.ClientNotification({title:e.deploymentDeletionInProgressLabel,description:e.deploymentDeletionInProgressMessage.format(f,o),status:p.InProgress});return r.publish(),i(!1),c.
callRaw({armApiOrUri:h.singleDeploymentApi(u),httpMethod:"DELETE",isBackgroundTask:!1,cloudName:n._cloudName,telemetry:c.makeResourceManagerTelemetry("DeploymentDetails.deleteCommand")}).then((function(t){n._view.item().properties().provisioningState("Deleting");var i=t.jqXHR.getResponseHeader("Location");i?n._startPolling(u,i,r):(nt.error("Unable to poll for deployment status since location header is missing."),r.title=e.deploymentDeletionPollingFailedLabel,r.description=e.deploymentDeletionPollingFailedMessage.format(f,o),r.status=p.Warning,r.publish())}),(function(n){var t=n&&n.responseText;t||(t=JSON.stringify(t));r.title=e.deploymentDeletionFailedLabel;r.description=e.deploymentDeletionFailedMessage.format(f,o);r.status=p.Error;r.publish();nt.error("Error deleting deployment. Error: {0}".format(t));i(!0)}))}return i(!0),Q(null)}},t},t.prototype._getCancelCommand=function(){var i=this,n=new b.DialogButton,t=u.observable(!1);return n.label(e.deploymentCancelCommandText),n.icon(g.Canceled(
)),u.reactor(this._container,(function(){var n=i._deploymentStateLowerCase();t(n===v.Running||n===v.Deploying||n===v.Accepted)})),n.dialogOptions=new it.MessageBox(e.deploymentCancelCommandConfirmationTitle,e.deploymentCancelCommandConfirmationMessage,4),n.command={canExecute:t,execute:function(n){if(n===6){t(!1);var o=i._deploymentId(),s=w.parseDeploymentDescriptor(o),u=s.resourceGroup,f=s.deploymentName,r=new tt.ClientNotification({title:e.deploymentCancelNotificationTitle,description:e.deploymentCancelProgressNotificationDescription.format(f,u),status:p.InProgress});return r.publish(),c.callRaw({armApiOrUri:h.cancelDeploymentApi(o),httpMethod:"POST",isBackgroundTask:!1,cloudName:i._cloudName,telemetry:c.makeResourceManagerTelemetry("DeploymentDetails.cancelCommand")}).then((function(){i._view.item().properties().provisioningState("Canceled");r.description=e.deploymentCancelSucceededNotificationDescription.format(f,u);r.status=p.Success;r.publish()}),(function(n){var i=n&&n.jqXHR&&n.jqXHR.
responseText;r.description=e.deploymentCancelFailedNotificationDescription.format(f,u,i);r.status=p.Error;r.publish();nt.error("Error canceling deployment. Error: {0}".format(i));t(!0)}))}return t(!0),Q(null)}},n},t.prototype._startPolling=function(n,t,i){var u=this,o=w.parseDeploymentDescriptor(n),s=o.deploymentName,f=o.resourceGroup,c=w.buildResourceGroupIdFromSubscriptionAndResourceGroupName(o.subscription,f),h=function(){return u._stopPolling(),st.Internal.ajaxExtended({uri:t,type:"GET",cache:!1,setAuthorizationHeader:!0,cloudName:u._cloudName}).then((function(t){var r=t.jqXHR;r.status===204||r.status===200?(u._context.deploymentsQueryCache.applyChanges((function(t,i){var r=i.data().firstIndex((function(t){return t.id()===n}));r>=0&&i.data.splice(r,1)}),(function(n){return n.resourceGroupId.toLowerCase()===c.toLowerCase()})),i.title=e.deploymentDeletionSuccessLabel,i.description=e.deploymentDeletionSuccessMessage.format(s,f),i.status=p.Success,i.publish()):u._pollHandle=rt.setTimeout(h,u._pollingIntervalInMilliseconds)})
,(function(n){nt.error(r.createError("Error polling for status of delete deployment operation. Poll Uri: "+t,{data:{name:s,rg:f},innerErrors:n}));i.title=e.deploymentDeletionPollingFailedLabel;i.description=e.deploymentDeletionPollingFailedMessage.format(s,f);i.status=p.Warning;i.publish()}))};h()},t.prototype._stopPolling=function(){this._pollHandle&&(rt.clearTimeout(this._pollHandle),this._pollHandle=null)},t})(a.ViewModel),et,ot;t.DeploymentSummaryPart=ht;et=(function(n){function t(t,i,r){var f=this;n.call(this,i);this._view=r.deploymentEntityCache.createView(t,{interceptNotFound:!0});u.computed(t,(function(){var i=f._view.item(),r,n,o;i&&i.properties&&(r=u.toJS(i.properties()),n=[],r.outputs?(o=r.outputs,ut(o,(function(i,r){var u=r.value;typeof r.value=="object"&&(u=JSON.stringify(r.value));n.push(new a.CopyFieldProperty(t,i,u))})),n.length||n.push(new a.TextProperty(e.deploymentOutputParametersMissing,""))):n.push(new a.TextProperty(e.deploymentOutputParametersMissing,"")),f.setProperties(
n))})).extend({throttle:10})}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=n.deploymentId;if(t)return this._view.fetch({deploymentId:t,cloudName:k.readFromInputs(n)})},t})(a.ViewModel);t.DeploymentOutputsPart=et;ot=(function(n){function t(t,i,r){var f=this;n.call(this,i);this._view=r.deploymentEntityCache.createView(t,{interceptNotFound:!0});u.computed(t,(function(){var r=f._view.item(),i,n,o;r&&r.properties&&(i=u.toJS(r.properties()),n=[],i.parametersLink?n.push(new a.LinkProperty(e.deploymentInputsParametersLinkLabel,i.parametersLink.uri)):i.parameters?(o=i.parameters,ut(o,(function(i,r){var u=r.value;typeof u=="object"&&(u=JSON.stringify(r.value));n.push(new a.CopyFieldProperty(t,i,u))})),n.length||n.push(new a.TextProperty(e.deploymentInputParametersMissing,""))):n.push(new a.TextProperty(e.deploymentInputParametersMissing,"")),f.setProperties(n))})).extend({throttle:10})}return __extends(t,n),t.prototype.onInputsSet=function(n){var t=n.deploymentId;if(t)return this._view.
fetch({deploymentId:t,cloudName:k.readFromInputs(n)})},t})(a.ViewModel);t.DeploymentInputsPart=ot})(a||(a={})),a}));define("HubsExtension/ResourceMap/ViewModels/DeploymentOperationsPartViewModel",["require","exports","f","i","ko","HubsExtension/ResourceMap/ResourceMapClientStrings","HubsExtension/ResourceMap/ResourceMapCommon"],(function(n,t,i,r,u,f,e){"use strict";var o;return (function(n){var o=r.Extension.CloudName,s=i.ViewModels,t=s.Controls.Lists.Grid,h=t.Format,c=t.ViewModel,l=(function(n){function i(i,r,o){var l=t.Extensions.SelectableRow|t.Extensions.SortableColumn,a={selectableRow:{selectionMode:1,activateOnSelected:u.observable(!0)}},v=[{name:u.observable(""),itemKey:"icon",format:h.SvgIcon,width:u.observable("30px")},{name:u.observable(f.deploymentOperationResourceNameProperty),itemKey:"targetResourceName",width:u.observable("100px")},{name:u.observable(f.deploymentOperationResourceTypeProperty),itemKey:"targetResourceType",width:u.observable("100px")},{name:u.observable(f.deploymentOperationStatusCodeProperty),
itemKey:"status",width:u.observable("100px")},{name:u.observable(f.deploymentOperationTimestampProperty),itemKey:"timestamp",width:u.observable("100px")}],s=u.observableArray(),c;n.call(this,i,s,l,a);this.showHeader=!0;this.columns=u.observableArray(v);this._view=o.deploymentOperationsQueryCache.createView(i);c=this._view.items.map(i,(function(n,t){var i=t.properties(),r=i.targetResource&&i.targetResource();return r?{id:t.id,provisioningState:i.provisioningState,icon:u.pureComputed((function(){return e.deploymentStatusIconLookup[i.provisioningState().toLowerCase()]})),targetResourceName:r.resourceName,targetResourceType:r.resourceType,status:i.statusCode,timestamp:i.timestamp}:null})).filter(i,(function(n){return!!n}));c.subscribe(i,s)}return __extends(i,n),i.prototype.onInputsSet=function(n){return this._view.fetch({deploymentId:n.deploymentId,cloudName:o.readFromInputs(n)})},i})(c);n.DeploymentOperationsPart=l})(o||(o={})),o}));define("HubsExtension/ResourceMap/ViewModels/InfoboxPart",["require",
"exports","f","i","ko","HubsExtension/ResourceMap/ResourceMapClientStrings"],(function(n,t,i,r,u,f){"use strict";var e;return (function(n){function o(n,t){h.trace({source:"DeploymentDetails",action:"PurchaseValidationErrorInfobox",actionModifier:n,data:t})}var e=i.Base,s=r.Extension.CloudName,t=i.ViewModels,h=e.Diagnostics.Telemetry,c=(function(){function n(n,i,r){var s=this;this.infoBoxViewModel=u.observable(null);this._subscriptionId="";this._deploymentId="";this._view=r.deploymentEntityCache.createView(n,{interceptNotFound:!0});u.computed(n,(function(){var l=s._view.item(),h,a,r,i,c;if(l&&(h=l.properties,h&&(a=u.toJS(h),r=a.error,r&&r.details&&r.details.some((function(n){return n.code&&n.code.toLowerCase()==="resourcepurchasevalidationfailed"}))))){i=new t.Controls.InfoBox.LinkViewModel(n);c=new t.ClickableLink(u.observable("https://account.windowsazure.com/Subscriptions/?subscriptionId="+s._subscriptionId));c.onLinkOpened=function(){o("Clicked",s._deploymentId)};i.image(e.Images.StatusBadge.
Error());i.text(f.purchaseError);i.clickableLink=u.observable(c);s.infoBoxViewModel(i);o("Shown",s._deploymentId);return}s.infoBoxViewModel(null)}))}return n.prototype.onInputsSet=function(n){var r=s.readFromInputs(n),i=this._deploymentId=n.deploymentId;return this._subscriptionId=t.Services.ResourceTypes.parseDeploymentDescriptor(i).subscription,this._view.fetch({deploymentId:i,cloudName:r})},n})();n.InfoboxPart=c})(e||(e={})),e}));define("HubsExtension/_generated/Blades/DeploymentStyles.css",["require","exports"],(function(){"use strict";return".ext-hubs-deployments-part-message{float:left;max-width:80%;white-space:nowrap;overflow:hidden}.ext-hubs-deployments-part-icon{float:right;width:16px;height:16px}"}));define("HubsExtension/_generated/Blades/DeploymentDetailsBlade",["require","exports","HubsExtension/_generated/Blades/DeploymentStyles.css","HubsExtension/ResourceMap/ResourceMapClientStrings","HubsExtension/ResourceMap/ViewModels/DeploymentDetailsBladeViewModel","HubsExtension/ResourceMap/ViewModels/InfoboxPart",
"HubsExtension/ResourceMap/ViewModels/DeploymentDetailsPartViewModel","HubsExtension/ResourceMap/ViewModels/DeploymentOperationsPartViewModel"],(function(n,t,i,r){"use strict";var u;return (function(n){n.blade={name:"DeploymentDetailsBlade",inputs:["id"],optionalInputs:["referrerInfo"],templateKeyInputs:["id"],viewModelName:"ResourceMap$DeploymentDetailsBlade",lenses:[{name:"InfoboxLens",partInstances:[{name:"InfoboxPart",inline:{styleSheets:[{file:"Blades/DeploymentStyles.css",content:i}],viewModel:"ResourceMap$InfoboxPart",partKind:0,inputs:["deploymentId"],bindings:[{property:"deploymentId",valuesFrom:[{referenceType:1,property:"id"}]}],details:[],initialSize:8,supportedSizes:[8],htmlTemplateInline:{file:"InfoboxPartTemplate.html",content:'<div style="margin: -15px 0 -30px 0"> <!-- ko if: infoBoxViewModel() --> <div data-bind="pcControl: infoBoxViewModel()"><\/div> <!-- /ko --> <\/div>'}}}]},{title:r.deploymentSummaryLensTitle,name:"DeploymentSummaryDetailsLens",partInstances:[{name:"DeploymentSummaryDetailsPart",
inline:{styleSheets:[],viewModel:"ResourceMap$DeploymentSummaryPart",partKind:24,inputs:["deploymentId"],bindings:[{property:"deploymentId",valuesFrom:[{referenceType:1,property:"id"}]}],details:[{invocationInputArguments:[{valuesFrom:[{referenceType:0,property:"content.selection"}]}]}],initialSize:8}}]},{title:r.deploymentOutputsLensTitle,name:"DeploymentOutputsDetailsLens",partInstances:[{name:"DeploymentOutputsDetailsPart",inline:{styleSheets:[],viewModel:"ResourceMap$DeploymentOutputsPart",partKind:24,inputs:["deploymentId"],bindings:[{property:"deploymentId",valuesFrom:[{referenceType:1,property:"id"}]}],details:[],initialSize:8}}]},{title:r.deploymentInputsLensTitle,name:"DeploymentInputsDetailsLens",partInstances:[{name:"DeploymentInputsDetailsPart",inline:{styleSheets:[],viewModel:"ResourceMap$DeploymentInputsPart",partKind:24,inputs:["deploymentId"],bindings:[{property:"deploymentId",valuesFrom:[{referenceType:1,property:"id"}]}],details:[],initialSize:8}}]},{title:r.deploymentOperationDetailsLensTitle,
name:"DeploymentOperationDetailsLens",partInstances:[{name:"DeploymentOperationsPart",inline:{styleSheets:[],viewModel:"ResourceMap$DeploymentOperationsPart",partKind:14,inputs:["deploymentId"],bindings:[{property:"deploymentId",valuesFrom:[{referenceType:1,property:"id"}]}],details:[{selectablePath:"content.selectableData",blade:"DeploymentOperationPropertiesBlade",selectableBindings:[{property:"operationId",valuesFrom:[{referenceType:6,property:"id"}]}]}],initialSize:8}}]}],viewModelInputs:[{property:"deploymentId",valuesFrom:[{referenceType:1,property:"id"}]}],locked:!0,style:1,toolbar:{source:{valuesFrom:[{referenceType:0,property:"content.toolbar",part:"DeploymentSummaryDetailsPart"}]}},attributes:0}})(u||(u={})),u}))