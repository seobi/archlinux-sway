define("HubsExtension/BrowseGrid2/ChooseColumnsBlade/ChooseColumnsBlade",["require","exports","f","i","ko","Fx/Composition/TemplateBlade","Fx/Controls/Button","Fx/Controls/CustomHtml","Fx/Controls/DropDown","Fx/Controls/EditableGrid","Fx/Controls/TextBox","HubsExtension/Browse/BrowseClientStrings","HubsExtension/Common/AssetTypeCache","HubsExtension/HubsCommon","HubsExtension/ResourceMap/ResourceMapCommon","HubsExtension/Tags/TagsArea","HubsExtension/Svg/SvgDefinitions"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){"use strict";var b=i.Base,nt=i.ViewModels,ut=nt.Forms.CheckBox,k=nt.Controls.Lists.Grid,d=nt.Controls.Markdown,ft=window,g=ft.fx.environment.hubsLinks.tagsHelp,et=u.utils.peekObservable,rt=w.Svg.Library,tt=i.isFeatureEnabled("showempty"),ot=(function(){function n(){}return n.prototype.onInitialize=function(){var n=this,o=this.context,t=o.container,h=o.model,f=o.parameters,c=r.Extension.CloudName.readFromInputs(f),i,s;this.title=l.chooseColumnsTitle;this.subtitle=u.observable();
this._displayColumns=u.observableArray([]);this._sourceItems=u.observableArray([]);this._columnItems=u.observableArray([]);this.columnChooserV2=u.observable(v.columnChooserV2Enabled);i=u.observable(!1);v.columnChooserV2Enabled?(this._initializeSourceGrid(),this._initializeColumnGrid(),this._initializeActions(),this._canAddOrRemoveColumns=u.observable(!1),u.reactor(t,(function(){n.addButton.disabled(!i()||!n._canAddOrRemoveColumns()||!n.sourceGrid.selection.selectedRows().length)})),u.reactor(t,(function(){n.removeButton.disabled(!i()||!n._canAddOrRemoveColumns()||!n.columnGrid.selection.selectedRows().length)})),u.reactor(t,(function(){n.showNoSourceHelp(i()&&!n._sourceItems().length);switch(n._typeValue()){case"all":n.noSourceImage(b.Images.Properties());n.noSourceMarkdown.markdown(l.ChooseColumns.noAllColumnsMarkdown.format(g).replaceAll("\\n","\n"));break;case"properties":n.noSourceImage(b.Images.Properties());n.noSourceMarkdown.markdown(l.ChooseColumns.noPropertiesMarkdown.replaceAll("\\n",
"\n"));break;case"tags":n.noSourceImage(b.Images.Tag());n.noSourceMarkdown.markdown(l.ChooseColumns.noTagsMarkdown.format(g).replaceAll("\\n","\n"))}})),u.reactor(t,(function(){n.showNoColumnHelp(i()&&!n._columnItems().length)}))):this._initializeGrid();this._initializeActionBar();var e=f.resourceType,w=f.scopeResourceType,k=Q();return e.toLowerCase()===y.allResourcesTypeKey?this.subtitle(l.AssetTypeNames.AllResource.plural):k=a.getResourceTypeAssetTypeInformation(e,c).then((function(t){n.subtitle(t.compositeDisplayName.service)})),this._enableControls(!1),s=p.TagsData.getAllTagsForSubscriptions(f.subscriptions,c).then((function(i){var y=h.getVisibleBrowseColumns(e,w),p=h.getDefaultBrowseColumns(e,w),s=p(),f=y(),r,c,a,o;if(v.columnChooserV2Enabled){if(r=s.map((function(n){return{id:n.id,name:n.name,lowerName:n.name.toLowerCase(),icon:n.description&&rt.info_flat,isTag:!1,visible:u.observable(n.visible),description:n.description}})),n._allColumns=r.slice(),c={},i.forEach((function(n){var t=n.key(
).toLowerCase();c[t]||(r.push({id:"tags."+n.key().toLowerCase(),name:n.key(),lowerName:n.key(),icon:rt.tag_flat,isTag:!0,visible:u.observable(!1),description:l.chooserTagColumnNameFormat.format(n.key())}),c[t]=!0)})),f)for(r.forEach((function(n){var t=f.some((function(t){return t.id===n.id}));n.visible(t)})),a=function(n){var t=r.firstIndex((function(t){return t.id===f[n].id}));r.splice(0,0,r.splice(t,1)[0])},o=f.length-1;o>=0;o--)a(o);u.reactor(t,(function(){var t=r.filter((function(t){return t.visible()?!1:n._typeValue()==="properties"&&t.isTag?!1:n._typeValue()==="tags"&&!t.isTag?!1:!n._filterValue()||t.lowerName.indexOf(n._filterValue().toLowerCase())!==-1})).sort((function(n,t){return n.name.toLowerCase()<t.name.toLowerCase()?-1:1}));tt||n._sourceItems(t)}));u.reactor(t,(function(){var i=r.filter((function(n){return n.visible()})),t;n._columnItems()&&n._columnItems().length&&(t=n._columnItems(),i.sort((function(n,i){var u=t.indexOf(n),r=t.indexOf(i);return u===-1?r===-1?0:1:r===-1?-1:u-r})));tt||n.
_columnItems(i)}));n._enableControls(!0)}else n._columnComputed=u.computed(t,(function(){u.ignoreDependencies((function(){var r,o,h,e;if(s){if(r=s.map((function(n){return{id:n.id,name:n.name,visible:n.visible,description:n.description}})),o={},i.forEach((function(n){var t=n.key().toLowerCase();o[t]||(r.push({id:"tags."+n.key().toLowerCase(),name:l.chooserTagColumnNameFormat.format(n.key()),visible:!1,description:null}),o[t]=!0)})),f)for(r.forEach((function(n){var t=f.some((function(t){return t.id===n.id}));n.visible=t})),h=function(n){var t=r.firstIndex((function(t){return t.id===f[n].id}));r.splice(0,0,r.splice(t,1)[0])},e=f.length-1;e>=0;e--)h(e);var c=r.filter((function(n){return n.visible})),a=r.filter((function(n){return!n.visible})).sort((function(n,t){return n.name.toLowerCase()<t.name.toLowerCase()?-1:1})),v=r.concat.apply(c,a),y=v.map((function(n){var i={inlineLabel:!0,label:u.observable(n.name),defaultValue:u.observable(et(n.visible)),infoBalloonContent:u.observable(n.description)};return{id:n.id,
nameCheckboxViewModel:new it(t,i)}}));tt||n._displayColumns(y);n._enableControls(!0)}}))}))})),s.finally((function(){i(!0)})),t.revealContent(),Q.all([k,s])},n.prototype._enableControls=function(n){n===void 0&&(n=!0);this.updateButton.disabled(!n);this.resetButton.disabled(!n);this.columnsGridViewModel&&this.columnsGridViewModel.disabled(!n);this.sourceGrid&&this.sourceGrid.disabled(!n);this.columnGrid&&this.columnGrid.disabled(!n);this._canAddOrRemoveColumns&&this._canAddOrRemoveColumns(n)},n.prototype._initializeActionBar=function(){var n=this,r=this.context,u=r.model,i=r.container,t=r.parameters;this.updateButton=e.create(i,{text:l.ChooseColumns.update,disabled:!0,onClick:function(){var r,f,e;n._enableControls(!1);v.columnChooserV2Enabled?(r={},f=n._columnItems().map((function(n){return r[n.id]=!0,{id:n.id,name:n.name,visible:n.visible()}})),n._allColumns.forEach((function(n){r[n.id]||(r[n.id]=!0,f.push({id:n.id,name:n.name,visible:!1}))})),u.setPersistedBrowseColumns(t.resourceType,t.scopeResourceType,
f)):(e=n._displayColumns().map((function(n){return{id:n.id,name:n.nameCheckboxViewModel.label(),visible:n.nameCheckboxViewModel.value()}})),n._columnComputed.dispose(),u.setPersistedBrowseColumns(t.resourceType,t.scopeResourceType,e));i.closeCurrentBlade({update:!0})}});this.resetButton=e.create(i,{text:l.ChooseColumns.reset,disabled:!0,style:1,onClick:function(){n._enableControls(!1);u.setPersistedBrowseColumns(t.resourceType,t.scopeResourceType,null);i.closeCurrentBlade({update:!0})}})},n.prototype._initializeSourceGrid=function(){var n=this.context.container,t;this.sourceMarkdown=new d.ViewModel(n,{markdown:l.ChooseColumns.sourceMarkdown.format(g).replaceAll("\\n","\n")});this._filterValue=u.observable();this.filterTextBox=c.create(n,{value:this._filterValue,ariaLabel:l.ChooseColumns.Aria.filterTextBox,placeHolderText:l.ChooseColumns.filterPlaceholder,suppressDirtyBehavior:!0});t=[{text:l.ChooseColumns.Types.all,value:"all"},{text:l.ChooseColumns.Types.properties,value:"properties"},{
text:l.ChooseColumns.Types.tags,value:"tags"},];this._typeValue=u.observable("all");this.typeDropDown=s.create(n,{value:this._typeValue,ariaLabel:l.ChooseColumns.Aria.typeDropDown,items:t,suppressDirtyBehavior:!0});this.showNoSourceHelp=u.observable(!1);this.noSourceImage=u.observable(b.Images.Tag());this.noSourceMarkdown=new d.ViewModel(n,{markdown:u.observable(l.ChooseColumns.noTagsMarkdown.format(g).replaceAll("\\n","\n"))});this.sourceGrid=h.create(n,{ariaLabel:l.ChooseColumns.Aria.sourceGrid,items:this._sourceItems,header:{visible:!1},defineRow:function(n,t){return{ariaLabel:l.ChooseColumns.Aria.rowDescription.format(t.name)}},columns:[{id:"name",header:l.ChooseColumns.Columns.column,defineCell:function(n,t){return o.create(n,{htmlTemplate:"<div class='ext-name-field' data-bind='text:name'><\/div><!-- ko if: icon --><div class='ext-name-icon msportalfx-svg-c07' data-bind='image:icon,attr:{title:description}'><\/div><!-- /ko -->",innerViewModel:t})}},]})},n.prototype._initializeColumnGrid=
function(){var n=this.context.container;this.columnMarkdown=new d.ViewModel(n,{markdown:l.ChooseColumns.columnMarkdown.replaceAll("\\n","\n")});this.showNoColumnHelp=u.observable(!1);this.noColumnImage=u.observable(b.Images.Columns());this.noColumnMarkdown=new d.ViewModel(n,{markdown:u.observable(l.ChooseColumns.noColumnsMarkdown.replaceAll("\\n","\n"))});this.columnGrid=h.create(n,{ariaLabel:l.ChooseColumns.Aria.columnGrid,items:this._columnItems,header:{visible:!1},defineRow:function(n,t){return{ariaLabel:l.ChooseColumns.Aria.rowDescription.format(t.name)}},reordering:{},columns:[{id:"name",header:l.ChooseColumns.Columns.column,defineCell:function(n,t){return o.create(n,{htmlTemplate:"<div class='ext-name-field' data-bind='text:name'><\/div><!-- ko if: icon --><div class='ext-name-icon msportalfx-svg-c07' data-bind='image:icon,attr:{title:description}'><\/div><!-- /ko -->",innerViewModel:t})}},]})},n.prototype._initializeActions=function(){var n=this,t=this.context,u=t.model,r=t.container;
this.addButton=e.create(r,{text:"",ariaLabel:l.ChooseColumns.Aria.addColumn,icon:{image:i.Base.Images.ArrowRight({customClass:"ext-escapeShadow"}),position:1},disabled:!0,onClick:function(){var t=n.sourceGrid.selection.selectedRows().slice();t.forEach((function(n){n.item.visible(!0)}));n.sourceGrid.selection.unselectAllRows()}});this.removeButton=e.create(r,{text:"",ariaLabel:l.ChooseColumns.Aria.removeColumn,icon:{image:i.Base.Images.ArrowLeft({customClass:"ext-escapeShadow"}),position:0},disabled:!0,onClick:function(){var t=n.columnGrid.selection.selectedRows().slice();t.forEach((function(n){n.item.visible(!1)}));n.columnGrid.selection.unselectAllRows()}})},n.prototype._initializeGrid=function(){var n=this,t=this.context.container,i=k.Extensions.SelectableRow|k.Extensions.ReorderRow,r={selectableRow:{selectionMode:1},reorderRow:{},resizableColumn:{resizable:u.observable(!1)}};this.columnsGridViewModel=new k.ViewModel(t,this._displayColumns,i,r);this.columnsGridViewModel.noRowsMessage(l.loading);
this.columnsGridViewModel.columns=u.observableArray([{name:u.observable(l.ChooseColumns.Columns.column),itemKey:"nameCheckboxViewModel",format:k.Format.HtmlBindings,formatOptions:{htmlBindingsTemplate:"<div data-bind='pcControl:settings.item.nameCheckboxViewModel'><\/div>",htmlBindingsType:k.HtmlBindingsType.Default}},]);this.columnsGridViewModel.selectableData.selectedItems.subscribe(t,(function(t){t.forEach((function(t){n.columnsGridViewModel.items().first((function(i){return n.columnsGridViewModel.selectableData.itemMatchesSelection(i,t)?(i.nameCheckboxViewModel.toggleFromSelection(),!0):!1}))}));t.length&&n.columnsGridViewModel.selectableData.selectedItems([])}))},__decorate([f.Decorator({htmlTemplate:"ChooseColumnsBlade.html",styleSheets:["ChooseColumnsBlade.css"]}),f.ForContextPane.Decorator({width:1}),f.LegacyFeatures.Decorator({width:1}),f.ReturnsData.Decorator()],n)})(),it;t.ChooseColumnsBlade=ot;it=(function(n){function t(t,i){var r=this;n.call(this,t,i);this._changed=u.observable(!1);
this.value.subscribe(t,(function(){if(!r._changed())try{r._changed(!0);r.value(!r.value())}finally{r._changed(!1)}}))}return __extends(t,n),t.prototype.toggleFromSelection=function(){try{this._changed(!0);this.value(!this.value())}finally{this._changed(!1)}},t})(ut.ViewModel);t.SelectionToggleCheckboxViewModel=it}));define("HubsExtension/_generated/adapters/blade/ChooseColumnsBladeAdapter",["require","exports","Fx/Composition/ViewModelAdapters","HubsExtension/BrowseGrid2/ChooseColumnsBlade/ChooseColumnsBlade"],(function(n,t,i,r){"use strict";var u=(function(n){function t(t,i,u){n.call(this,t,i,u,r.ChooseColumnsBlade)}return __extends(t,n),t})(i.ViewModelAdapter);t.ChooseColumnsBladeAdapter=u}));define("HubsExtension/_generated/Blades/ChooseColumnsBlade.css",["require","exports"],(function(){"use strict";return".ext-chooser-container{margin-left:25px;width:calc(100% - 50px)}.ext-container{display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;height:calc(100% - 50px);margin-top:25px}.ext-innercontainer{-webkit-flex:1 1 100%;flex:1 1 100%;display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;align-items:stretch}.ext-panel{-webkit-flex:1 1 0%;flex:1 1 0%;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:stretch;justify-content:stretch;padding:12px;margin:8px;border:1px solid #dcdfe2;overflow:hidden}.ext-panel-header{-webkit-flex:0 0 auto;flex:0 0 auto}.ext-filter-container{-webkit-flex:0 0 auto;flex:0 0 auto;display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row;-webkit-align-items:stretch;align-items:stretch}.ext-filter-textbox{-webkit-flex:1 1 100%;flex:1 1 100%;margin-top:8px;margin-right:2px}.ext-filter-dropdown{-webkit-flex:0 0 90px;flex:0 0 90px;margin-top:8px;margin-left:2px}.ext-noitems{-webkit-flex:1 1 auto;flex:1 1 auto;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-align-items:center;align-items:center;overflow-y:auto}.ext-noitemsicon{height:100px;width:100px;padding-top:40px;padding-bottom:20px;opacity:.3}.ext-noitemsmarkdown{overflow:visible}.ext-actions{-webkit-flex:0 0 40px;flex:0 0 40px;display:-webkit-flex;display:flex;-webkit-flex-direction:column;flex-direction:column;-webkit-justify-content:center;justify-content:center}.ext-action{-webkit-flex:0 0 auto;flex:0 0 auto;min-width:0;width:calc(100% - 16px);height:32px;margin:4px;padding:4px;text-align:center}.ext-grid{padding:10px 25px 0}.ext-gridv2{-webkit-flex:1 1 100%;flex:1 1 100%;margin-top:8px;padding:0;overflow-y:auto}.ext-okbutton,.ext-cancelbutton{width:94px;margin-right:5px}.ext-top-padding{padding-top:25px}.ext-bottom-padding{padding-bottom:25px}.ext-name-field{display:inline-block;margin-right:4px;vertical-align:middle}.ext-name-icon{display:inline-block;padding:0;margin:2px;width:12px;height:12px;vertical-align:baseline}"})
);define("HubsExtension/_generated/Blades/ChooseColumnsBlade",["require","exports","HubsExtension/_generated/Blades/ChooseColumnsBlade.css","HubsExtension/_generated/adapters/blade/ChooseColumnsBladeAdapter"],(function(n,t,i){"use strict";var r;return (function(n){n.blade={name:"ChooseColumnsBlade",inputs:["resourceType","subscriptions"],optionalInputs:["scopeResourceType"],viewModelName:"BrowseGrid2$ChooseColumnsBladeAdapter",lenses:[],width:1,pinnable:!1,style:8,toolbar:{source:{valuesFrom:[{referenceType:0,property:"content.commandBar"}]}},templateBlade:{htmlTemplate:null,partSize:9,htmlTemplateInline:{file:"ChooseColumnsBlade.html",content:'<div class="msportalfx-docking ext-chooser-container"> <div class="msportalfx-docking-body"> <!-- ko if: columnChooserV2 --> <div class="ext-container"> <div class="ext-innercontainer"> <div class="ext-panel"> <div class="ext-panel-header" data-bind="pcControl:sourceMarkdown"><\/div> <div class="ext-filter-container"> <div class="ext-filter-textbox" data-bind="pcControl:filterTextBox"><\/div> <div class="ext-filter-dropdown" data-bind="pcControl:typeDropDown"><\/div> <\/div> <div class="msportalfx-grid-borderless ext-gridv2" data-bind="pcControl:sourceGrid,visible:!showNoSourceHelp()"><\/div> <div class="ext-noitems" data-bind="visible:showNoSourceHelp()"> <div class="ext-noitemsicon msportalfx-svg-disabled" data-bind="image:noSourceImage"><\/div> <div class="ext-noitemsmarkdown" data-bind="pcControl:noSourceMarkdown"><\/div> <\/div> <\/div> <div class="ext-actions"> <div data-bind=\'pcControl:addButton\' class="ext-action"><\/div> <div data-bind=\'pcControl:removeButton\' class="ext-action"><\/div> <\/div> <div class="ext-panel"> <div class="ext-panel-header" data-bind="pcControl:columnMarkdown"><\/div> <div class="msportalfx-grid-borderless ext-gridv2" data-bind="pcControl:columnGrid,visible:!showNoColumnHelp()"><\/div> <div class="ext-noitems" data-bind="visible:showNoColumnHelp()"> <div class="ext-noitemsicon msportalfx-svg-disabled" data-bind="image:noColumnImage"><\/div> <div class="ext-noitemsmarkdown" data-bind="pcControl:noColumnMarkdown"><\/div> <\/div> <\/div> <\/div> <\/div> <!-- /ko --> <!-- ko ifnot: columnChooserV2 --> <div class="msportalfx-grid-borderless ext-grid" data-bind="pcControl:columnsGridViewModel"><\/div> <!-- /ko --> <\/div> <div class=\'msportalfx-docking-footer ext-top-padding ext-bottom-padding\'> <div data-bind=\'pcControl:updateButton\' class=\'ext-okbutton\'><\/div> <div data-bind=\'pcControl:resetButton\' class=\'ext-cancelbutton\'><\/div> <\/div> <\/div>'},
styleSheets:[{file:"Blades/ChooseColumnsBlade.css",content:i}],isV2:!0},attributes:1,contextPaneWidth:1}})(r||(r={})),r}))