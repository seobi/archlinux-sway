define("HubsExtension/ArmHelpers/Models/ArmResourceInstance",["require","exports","f","HubsExtension/ArmHelpers/Models/ArmResource","HubsExtension/ArmHelpers/Models/ArmResourceGroup"],(function(n,t,i,r,u){"use strict";var f;return (function(t){function o(n){return n?f.isResourceGroupId(n.id)?u.toResourceGroup(n):f.isResourceId(n.id)||f.isTenantResource(n.id)?r.toResource(n):null:null}var e=i.Base.Diagnostics,f=i.ViewModels.Services.ResourceTypes,s=e.createLog(n);t.toResourceInstance=o})(f||(f={})),f}));define("HubsExtension/Common/ResourceIconMap",["require","exports","f"],(function(n,t,i){"use strict";var r;return (function(n){function t(n,t,i){t.setUseResourceMenu&&n.useResourceMenu!==undefined&&t.setUseResourceMenu(n.useResourceMenu);t.setIsPreview&&n.isPreview!==undefined&&t.setIsPreview(n.isPreview);t.setIcon&&n.icon&&t.setIcon(n.icon);t.setKindBlade&&n.bladeName&&t.setKindBlade(n.bladeName,n.bladeExtensionName||i);t.setAssetTypeDisplayName&&n.singularDisplayName&&t.setAssetTypeDisplayName(
n.singularDisplayName);t.setLowerAssetTypeDisplayName&&n.lowerSingularDisplayName&&t.setLowerAssetTypeDisplayName(n.lowerSingularDisplayName)}function u(n,i,u,f){var s,e,o;r.isResourceId(i)&&(s=u&&u.toLowerCase(),e=f.assetTypeInformation,e&&e.kinds&&!e.kinds.some((function(i){return(!i.isDefault||(o=i),i.name.toLowerCase()===s)?(t(i,n,e.extensionName),!0):!1}))&&o&&t(o,n,e.extensionName))}var r=i.ViewModels.Services.ResourceTypes;n.checkItemKind=u})(r||(r={})),r}));define("HubsExtension/_generated/HtmlTs/BrowseGrid2/BrowseBlades/Templates/NameColumn",["require","exports","f"],(function(){"use strict";return function(){return'<span class="msportalfx-gridcolumn-assetsvg-icon" aria-hidden="true" data-bind="image:item.icon,attr:{title:item.assetType}"><\/span><!-- ko if: item.isPreview --><span class="msportalfx-gridcolumn-assetsvg-badge" aria-hidden="true" data-bind="image:MsPortalFx.Base.Images.Polychromatic.Preview(),attr:{title:item.assetType}"><\/span><!-- /ko --><span class="msportalfx-gridcolumn-assetsvg-text" data-bind="text:value"><\/span><!-- ko if: item.externalLink --><div class="msportalfx-gridcolumn-assetsvg-linkicon"><div class="msportalfx-gridcolumn-assetsvg-linkicon-icon" data-bind="image:MsPortalFx.Base.Images.Hyperlink()"><\/div><\/div><!-- /ko -->'}
}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/BrowseBulkCommandImpl",["require","exports","f","ko"],(function(n,t,i,r){"use strict";var u;return (function(n){var t=i.ViewModels,f=t.Dialogs,u=(function(){function n(n,t,i,u){var f=this;this._canExecute=r.observable(!0);this._cmdDef=t;this._cloudName=i;this._cmdContext=u;this.canExecute=r.computed(n,(function(){return f._cmdContext.hasSelectedItems()&&f._canExecute()}))}return n.prototype.execute=function(n){var t=this;if(this._canExecute(!1),n===6||n===4){var r=this._cmdContext.selectedBrowseItems(),u=r.map((function(n){return{name:n.name,resourceId:n.resourceId,resourceType:n.resourceType.toLowerCase()}})),f=i.require("HubsExtension/ArmHelpers/ArmBulkCommand").then((function(n){return n.execute(t._cmdDef,t._cmdContext.resourceType,u,t._cloudName)}));return this._canExecute(!0),f.then((function(){if(t._cmdContext.onCompleteCallback)return t._cmdContext.onCompleteCallback(r)}))}return this._canExecute(!0),Q()},n})();n.BulkCommandImpl=
u})(u||(u={})),u}));define("HubsExtension/BrowseGrid2/BulkDeleteBlade/BulkDeleteBladeModel",["require","exports"],(function(){"use strict";var n;return (function(n){n.MaxBatchDeleteResources=100})(n||(n={})),n}));define("HubsExtension/Common/CommonErrorHandling",["require","exports","HubsExtension/Assets/AssetsClientStrings"],(function(n,t,i){"use strict";var r;return (function(n){function t(n,t){var i=[0,401,403,404];return t&&(i=i.concat([500,503])),n&&i.indexOf(n.status)>=0}function r(n,t,r){var f=n,u=n&&f.status;return u===404?{title:i.notFound,message:i.notFoundAssetTitle.format(t||""),type:0}:u===403||u===401?{title:i.unauthorized,message:i.unauthorizedAssetTitle.format(t||""),type:1}:u===0||u===500||u===503||u===undefined&&r?{title:i.unavailable,message:i.unavailableAssetTitle.format(t||""),type:0}:null}function u(n,t){var i=n.type;i===0?t.notFound(n.message):i===1&&t.unauthorized(n.message)}function f(n){n.unauthorizedMessage(null);n.notFoundMessage(null)}n.isExpectedArmError=t;n.getErrorTitleAndMessage=
r;n.updateContainerForError=u;n.clearContainerError=f})(r||(r={})),r}));define("HubsExtension/Common/HubsPermissions",["require","exports","f","FxHubs/Permissions","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/Common/HubsObservables"],(function(n,t,i,r,u,f){"use strict";var e;return (function(n){function e(n,i){var r=[],e,o;return t.isResourceManagerId(n)&&(e=t.parseResourceManagerDescriptor(n).subscription,e&&f.isCoAdminOnSub(e,i))?Q(s):(o=u.callWithContinuation([u.getPermissionsApi(n)],(function(n){n.actions=n.actions||[];n.notActions=n.notActions||[];r=r.concat(n)}),(function(n){throw n.reason;}),i,u.makeResourceManagerTelemetry("HubsPermissions.getPermissions")),o.then((function(){return r})).catch((function(n){var t=n&&n.jqXHR&&n.jqXHR.status;switch(t){case 403:case 401:return[{actions:[],notActions:[]}]}throw n;})))}var t=i.ViewModels.Services.ResourceTypes,s=[{actions:["*"],notActions:[]}],o;n.getPermissionsFromArm=e,(function(i){function u(t,i,r,u){return n.hubsChecker.hasPermission(
t,i,r,u)}function o(t){return n.hubsChecker.getDiagnostics(t)}i.hasPermission=u;i.getDiagnostics=o;var s=(function(){function n(n){var t=this._permissionsCache=r.createCachedPermissionsGetter(e,n);this._cachedPermissionsGetter=t.getPermissions.bind(t)}return n.prototype.hasPermission=function(n,t,i,u){var f=r.PermissionChecker;return f.isRDFEAction(t)?this.hasRdfePermissions(n,u):f.hasPermission(n,t,i,u,this._cachedPermissionsGetter)},n.prototype.getDiagnostics=function(n){return this._permissionsCache.getCachedPermissions(n)},n.prototype.hasRdfePermissions=function(n,i){return t.isSubscriptionId(n)?f.getSubscriptionsPromise(i).then((function(){var u=t.parseSubscriptionDescriptor(n).subscription,e=f.getSubscriptionsObservable(i)()||{},r=(e.subscriptions||[]).first((function(n){return n.subscriptionID===u}));return!r||r.requireRdfe})):Q(!1)},n})();i.HubsPermissionsChecker=s})(o=n.Internal||(n.Internal={}));n.hubsChecker=new o.HubsPermissionsChecker})(e||(e={})),e}));define("HubsExtension/ResourceMap/ResourceTypeCache",
["require","exports","i","HubsExtension/ArmHelpers/ArmApis","HubsExtension/ArmHelpers/ArmApisStartup"],(function(n,t,i,r,u){"use strict";var f;return (function(n){function s(n,i){var r=u.makeResourceManagerTelemetry("ResourceTypesCache.get");return Q(t(n,i,r)).then((function(n){var t={};return n&&n.forEach((function(n){var i=n;i.resourceTypes&&i.resourceTypes.forEach((function(n){var r={resourceType:(i.namespace+"/"+n.resourceType).toLowerCase(),capabilities:n.capabilities};t[r.resourceType]=r}))})),t}))}function h(n,t){var o=t||"",e=f[o],u,h;return e||(f[o]=e=i.getCloudMap()),u=e.get(n),u||(h=r.listResourceProvidersWithMetadataApi(t),u=s(h,n),e.set(n,u)),u}function t(n,i,r,u){return u===void 0&&(u=0),o(n,"GET",null,i,r).then((function(n){var u=(n||{}).value;return u?n.nextLink&&u.length<100?t(n.nextLink,i,r).then((function(n){return u.concat(n)})):u:n?n:void 0})).catch((function(f){var e=f&&f.jqXHR||f;return e&&e.status>=500&&u<2?Q.delay(500).then((function(){return t(n,i,r,u+1)})):Q.reject(e)}))}var
e=window,o=e.HubsExtensionBrowseMockAjax||function(n,t,i,r,f){return u.call(n,t,i,r,f)},f={};n.getResourceTypeCache=h})(f||(f={})),f}));define("HubsExtension/ResourceMap/ViewModels/ResourceProviderViewModel",["require","exports","f","i","HubsExtension/ResourceMap/ResourceMapClientStrings","HubsExtension/_generated/ExtensionDefinition","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/Common/CommonErrorHandling","HubsExtension/ResourceMap/ResourceMapCommon","HubsExtension/ResourceMap/ResourceTypeCache"],(function(n,t,i,r,u,f,e,o,s,h){"use strict";function ot(n){if(o.isExpectedArmError(n,!0))return{error:n};throw n;}function a(n){return n().then((function(n){return{result:n}})).catch((function(n){return ot(n)}))}function it(n){return{id:n.id,name:n.name,location:n.location}}function d(n){return{id:n.id,name:n.name,location:n.location,type:n.type,kind:n.kind}}function st(n,t){return ft.signalResourcesChanged(t.resourcesInResourceGroup.map((function(n){return n.id})))}function rt(n,t){var i,
f,o,s,e,r;return n.length<1?{error:"unknown error",message:"unknown error",fullMessage:u.failedToDeleteResourceGroupUnknownError.format(t)}:n.length<2?(i=n[0],i.statusText)?{error:i.statusText,message:i.message,fullMessage:u.failedToDeleteResourceGroup.format(t,i.message),code:i.code,stack:i.stack}:i.message?{error:i.message,message:i.message,fullMessage:u.failedToDeleteResourceGroup.format(t,i.message),code:i.code,stack:i.stack}:{error:"unknown error",message:"unknown error",fullMessage:u.failedToDeleteResourceGroupUnknownError.format(t),code:i.code,stack:i.stack}:n.length<3?{error:n[1],message:"unknown error",fullMessage:u.failedToDeleteResourceGroup.format(t,n[1]),stack:n[1]&&n[1].stack}:(e=n[2],e&&e.responseText&&(r=JSON.parse(e.responseText),f=r&&r.httpStatusCode,o=r&&r.message,s=r&&r.httpStatus),{error:f||n[1],message:o||f||n[1],fullMessage:u.failedToDeleteResourceGroup.format(t,o||f||n[1]),stack:n[1]&&n[1].stack,status:s})}function ht(n,t){n.title=u.deletedResourceGroupLabel.format(
t);n.description=u.deletedResourceGroupDescription.format(t);n.status=k.Success;n.asset=undefined;n.publish()}function v(n,t,i,r){n.title=u.deleteResourceGroupFailedLabel.format(i);n.status=k.Error;r?r.code==="ScopeLocked"?(n.description=u.failedToDeleteResourceGroupLocked.format(i),n.asset=null,n.linkedBlade=nt.getBladeSelection(f.definitionName,"LocksBlade",{resourceId:t})):n.description=r.fullMessage:n.description=u.failedToDeleteResourceGroupUnknownError.format(i);n.linkedBlade||(n.asset={extensionName:f.definitionName,assetType:"ResourceGroupEvents",assetId:t});n.publish()}var ft=i.Assets,b=i.Base,g=b.Constants.AssetNames,k=i.Hubs.Notifications.NotificationStatus,nt=i.ViewModels,p=nt.Services.ResourceTypes,et=r.Hubs.Notifications,c=s.ResourceGroupClient,l=s.ResourceClient,tt=window,w=b.Diagnostics.createLog(n),ct=(function(){function n(){}return n.prototype.getResourceGroupResults=function(n,t,i){return y.getResourceGroupResults(n,t,i)},n.prototype.getResourceResults=function(n,t,i)
{return y.getResourceResults(n,t,i)},n.prototype.getResourceGroup=function(n,t,i,r){return a((function(){return c.getResourceGroupWithStrings(n,t,i,r)}))},n.prototype.getResource=function(n,t,i,r){return a((function(){return l.getResourceWithStrings(n,t,i,r)}))},n.prototype.getExtensionResource=function(n,t,i,r){return a((function(){return l.getExtensionResourceWithStrings(n,t,i,r)}))},n.prototype.deleteResourceGroup=function(n,t){return c.deleteResourceGroup(n,t)},n.prototype.getOperationResponse=function(n,t){return s.ResourceManagerOperationsClient.getOperationResponse(n,t)},n.prototype.getResourceTypeCache=function(n,t){return h.getResourceTypeCache(n,t)},n})(),y,ut;t.ResourceProviderViewModel=ct;y=(function(){function n(){}return n.getResourceGroupResults=function(n,t,i){return a((function(){var r={resourceGroup:null,resourcesInResourceGroup:[]};return c.getResourceGroup(n,t,i).then((function(n){return r.resourceGroup=it(n),n.id})).then((function(n){return l.getResourcesInResourceGroup(n,t,i).
then((function(n){return n.forEach((function(n){r.resourcesInResourceGroup.push(d(n))})),r}))}))}))},n.getResourceResults=function(n,t,r){return a((function(){var f=p.parseResourceDescriptor(n),u={resourceGroup:null,resource:null,resourcesInResourceGroup:[],resourcesLinkedFromResource:[],resourcesLinkedToResource:[]},e=p.buildResourceGroupIdFromResourceDescriptor(f);return c.getResourceGroup(e,t,r).then((function(n){return u.resourceGroup=it(n),n.id})).then((function(){return l.getResourcesInResourceGroup(p.buildResourceGroupIdFromResourceDescriptor(f),t,r).then((function(e){if(e.forEach((function(t){p.compareResourceId(t.id,n)&&(u.resource=d(t),t.tags&&i.forEachKey(t.tags,(function(n){if(n.toLowerCase().startsWith("hidden-link:")){var t=n.toLowerCase().indexOf("/subscriptions/");t!==-1&&u.resourcesLinkedFromResource.push(n.substr(t))}})));u.resourcesInResourceGroup.push(d(t))})),u.resource===null){var o=new Error("Failed to retrieve the resource.");o.status=404;throw o;}return l.getResourcesLinkedToResource(
f.subscription,n,t,r).then((function(n){return n.forEach((function(n){u.resourcesLinkedToResource.push(n.id)})),u}))}))}))}))},n})();t.ResourceProviderHelper=y;ut=(function(){function n(n,t,i){this._resourceGroup=n;this._resourceGroupName=t;this._cloudName=i}return n.prototype.execute=function(){var h=this,i=this._cloudName,n=this._resourceGroup,t=this._resourceGroupName,r=new et.InternalClientNotification({title:u.deletingResourceGroupLabel.format(t),description:u.deletingResourceGroupDescription.format(t),status:k.InProgress,asset:{extensionName:f.definitionName,assetType:g.ResourceGroups,assetId:this._resourceGroup},timestamp:new Date,cloudName:i}),l=e.makeResourceManagerTelemetry("ResourceGroupDeleteOperation");y.getResourceGroupResults(n,i,l).then((function(f){var e=f.error,l;e?(l={error:e.statusText,message:e.message,fullMessage:u.failedToDeleteResourceGroup.format(t,e.message)},o.isExpectedArmError(e)&&w.warning("Failed to delete the resource group: {0}. {1}.".format(l.error,l.message)),v(
r,n,t,l),s.notifyResourceGroupDeleteFailed(i,n)):(s.notifyResourceGroupDeleting(i,n),c.deleteResourceGroup(n,i).then((function(n){n.operationId&&r.correlationIds.push(n.operationId);r.publish();h._handleDeleteOperationPolling(n,r,f.result)}),(function(){for(var u,h=[],f=0;f<arguments.length;f++)h[+f]=arguments[f];u=rt(h,t);o.isExpectedArmError(e)&&w.warning("Failed to delete the resource group: {0}. {1}. {2}".format(u.error,u.message,u.stack||""));v(r,n,t,u);s.notifyResourceGroupDeleteFailed(i,n)})))}),(function(i){v(r,n,t);throw i;}))},n.prototype._handleDeleteOperationPolling=function(n,t,i){var c=this,f=this._cloudName,u=this._resourceGroup,e=this._resourceGroupName,h;n.status===200?(r.AssetManager.notifyAssetDeleted(g.ResourceGroups,this._resourceGroup,b.Constants.ExtensionNames.Hubs,f),ht(t,this._resourceGroupName),i&&st(u,i)):n.status===202?h=tt.setTimeout((function(){tt.clearTimeout(h);s.ResourceManagerOperationsClient.getOperationResponse(n.operationId,f).then((function(n){c._handleDeleteOperationPolling(
n,t,i)}),(function(){for(var n,r=[],i=0;i<arguments.length;i++)r[+i]=arguments[i];n=rt(r,e);o.isExpectedArmError(n)&&w.warning("Failed to delete the resource group: {0}. {1}. {2}".format(n.error,n.message,n.stack||""));v(t,u,e,n);s.notifyResourceGroupDeleteFailed(f,u)}))}),n.retryAfterInSeconds*1e3):(o.isExpectedArmError(n)&&w.warning("Failed to delete the resource group, Code: {0}.".format(n.status)),v(t,u,e),s.notifyResourceGroupDeleteFailed(f,u))},n})();t.ResourceGroupDeleteOperation=ut}));define("HubsExtension/_generated/HtmlTs/BrowseGrid2/BrowseBlades/Templates/TagsColumn",["require","exports"],(function(){"use strict";return function(){return'<!-- ko if: value --><div data-bind="pcControl:value"><\/div><!-- /ko -->'}}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Base",["require","exports","f","i","ko","$","Extensions/Hubs/PillList","Fx/Composition/Selectable","Fx/Controls/MoveResourceToolbarButton","HubsExtension/Browse/BrowseClientStrings","HubsExtension/ResourceMap/ResourceMapClientStrings",
"HubsExtension/_generated/BladeReferences","HubsExtension/_generated/ExtensionDefinition","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResourceInstance","HubsExtension/Browse/BrowseArea","HubsExtension/Common/AssetTypeCache","HubsExtension/Common/CloudNameHelpers","HubsExtension/Common/CommonErrorHandling","HubsExtension/Common/HubsObservables","HubsExtension/Common/HubsPermissions","HubsExtension/Common/ResourceIconMap","HubsExtension/HubsCommon","HubsExtension/Notifications/EventSubscriptionService","HubsExtension/ResourceMap/ResourceMapCommon","HubsExtension/ResourceMap/ViewModels/ResourceProviderViewModel","HubsExtension/Tags/TagsArea","HubsExtension/BrowseGrid2/BulkDeleteBlade/BulkDeleteBladeModel","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/BrowseBulkCommandImpl","HubsExtension/_generated/HtmlTs/BrowseGrid2/BrowseBlades/Templates/NameColumn","HubsExtension/_generated/HtmlTs/BrowseGrid2/BrowseBlades/Templates/TagsColumn"],(function(
n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht){"use strict";function ru(n){return typeof n=="number"&&ii[n]||(typeof n=="number"||n)&&n.toString()}function uu(){return{id:ii[1],name:u.observable(ct.Name.title),format:iu,activatable:!0,width:u.observable("200px"),sortable:!0}}function fu(n,t,r){var f=0;return n&&n.length&&n.some((function(n){var e=n.property.name,h="",c="",l,o,s;return tt.tagsV2Enabled&&e==="tagsArray"?(l={items:u.observableArray([])},h=(t.tagsArray()||l).items().map((function(n){return n.value})).sort().join(","),c=(r.tagsArray()||l).items().map((function(n){return n.value})).sort().join(",")):e.startsWith("tags.")?(o=lt(u.utils.unwrapObservablePath(t,e))||"",h=typeof o=="string"?o:o.item&&o.item().value||"",s=lt(u.utils.unwrapObservablePath(r,e))||"",c=typeof s=="string"?s:s.item&&s.item().value||""):(h=lt(u.utils.unwrapObservablePath(t,e))||"",c=lt(u.utils.unwrapObservablePath(r,e))||""),f=i.compare(h,c),f&&n.direction===0&&(f=-f),f!==0})),f}function rr(
n,t,i){var r=yt.parseResourceDescriptor(t);return n?n.format({resourceId:bt(t),name:bt(r.resource),type:bt(r.type),provider:bt(r.provider),resourceGroup:bt(r.resourceGroup),subscriptionId:bt(r.subscription),locationId:bt(i)}):null}function at(n,t,i){return{id:ii[n],name:t.title,description:t.description,visible:!i}}function vi(n){return{id:ii[12],name:ct.Tags.title,visible:!n,format:new ci.Grid2.Formatters.HtmlTemplate({template:ht()})}}function ur(n,t,i,r){return function(){n.closeContextBlade().then((function(){n.openContextPane(new l.EditTagsBladeReference(wt(t.browse_cloudName,{resource:t.id,tagName:r}),function(r,u){r===2&&u&&u.update&&(t.tagsProperty(u.newTags),ri(n,t,i))}))}))}}function yi(n,t,i,r,f){var o={label:r?f?h.addTag.format(r):h.editTag.format(r):h.editResourceTags.format(t.name),icon:pt.Edit(),enabled:u.observable(!0),onClick:ur(n,t,i,r)};return u.observable(new e.ViewModel(n,{label:h.tagsLabel.format(t.name),items:u.observableArray([]),actionButtons:[o]}))}function ri(n,
t,i){eu(n,t,i);ou(n,t)}function eu(n,t,r){var c=t.tags(),f={},s={},o=t.tagsProperty();i.forEachKey(o||{},(function(n){s[n.toLowerCase()]=n}));r().forEach((function(i){var a,v,y,l,p;if(i.id.startsWith("tags."))if(a=i.id.substring(5).toLowerCase(),tt.tagsV2Enabled)if(v=s[a],v){if(y={value:lt(o[v])},l=c[a],l&&l.item)l.item(y);else{var w=ur(n,t,r,a),b={label:h.editTag.format(v),icon:pt.Edit(),enabled:u.observable(!0),onClick:w},k={label:h.deleteTag.format(v),icon:pt.Delete(),enabled:u.observable(!0),onClick:function(){var i={telemetryName:"ConfirmDeleteTag",title:h.deleteTagTitle,content:h.deleteTagMessage.format(v),buttons:4,onClosed:function(i){if(i.button===6){var u=new ft.TagsData;u.deleteTag(v,lt(o[v]),t.id,t.browse_cloudName).then((function(){fr(n,t,r)}))}}};n.openDialog(i)}};l=new e.ViewModel(n,{label:h.resourceTagLabel.format(v,t.name),item:u.observable(y),actionButtons:[b,k]})}f[a]=l}else l=c[a],l&&l.items||(l=yi(n,t,r,a,!0)()),f[a]=l;else p=s[a],f[a]=lt(p&&o[p]||undefined)}));t.tags(f)}
function ou(n,t){var r=[],u=t.tagsProperty();i.forEachKey(u||{},(function(n,t){v.isHiddenTag(n)||r.push({value:h.tagLabel.format(n,lt(t))})}));t.tagsArray().items(r.sort((function(n,t){return i.compare(n.value,t.value)})))}function fr(n,t,i){var f=v.makeResourceManagerTelemetry("GridV2Browse.updateTags"),r,e=!1,u=t.id,o=t.browse_cloudName;nr(u)?(e=!0,r=tr(u,o,f,!0)):dr(u)&&(r=gr(u,o,f,!0));r&&r.then((function(r){t.tagsProperty(r.tags);ri(n,t,i);e&&t.status(r.provisioningState)})).catch((function(n){if(!k.isExpectedArmError(n))throw n;}))}function er(n,t){return d.getSubscriptionInfo(n,t)||{}}var sr=i.Assets,ni=i.Base,oi=ni.Constants,hr=oi.ResourceTypes,cr=r.Rpc,pi=ni.Diagnostics,si=pi.Telemetry,pt=ni.Images,wi=pt.Polychromatic,ui=r.Extension,ti=i.ViewModels,hi=r.ViewModels,lr=ti.Services.DynamicBlade,su=ti.ActionBars.Base,kt=ti.Toolbars,ar=ti.Dialogs,ci=hi.Controls.Lists,yt=ti.Services.ResourceTypes,vr=oi.AssetNames,yr=ci.Grid2.Formatters,dt=ni.Images.StatusBadge,pr=window,bi=pr.fx.environment,
li=pi.createLog(n),wr=h.BulkCommand,ct=h.Columns,gt=h.ProvisioningStates,br=a.BladeNames.resourceMenuBlade,kr=a.BladeNames.resources,ki=sr.assetTypeInformationSupportsContract,wt=ui.CloudName.addToModel,fi=ui.isEqualCloudName,lt=u.utils.peekObservable,di=i.extendArrayIntoMap,ei=i.getUniqueId,gi=hi.getBladeSelection,dr=yt.isResourceId,nr=yt.isResourceGroupId,ai=yt.compareResourceGroupId,gr=rt.ResourceClient.getResource,tr=rt.ResourceGroupClient.getResourceGroup,ir=wi.ResourceDefault(),nu=a.AssetTypes.ResourceGroups.Permissions,tu="BrowseItemActivated",iu=new ci.Grid2.Formatters.HtmlTemplate({template:st()}),ii=(vt={},vt[1]="name",vt[2]="kind",vt[3]="resourceGroup",vt[4]="location",vt[5]="locationId",vt[6]="resourceId",vt[7]="resourceGroupId",vt[8]="resourceType",vt[9]="subscription",vt[10]="subscriptionId",vt[11]="assetType",vt[12]="tagsArray",vt),bt,or,vt;t.mapColumnIdToString=ru;t.getNameColumn=uu;t.browseCompare=fu;bt=encodeURIComponent;or=(function(){function n(n,t){var r=this,s,f,e,
o;this.assetTypeInfo=u.observable();this.loaded=u.observable(!1);this.groupBy=u.observable("");this._mpItemId="";this._mpMenuItemId="";this._assetTypes={};this._ltm=n;this._columnContext=t.columnContext;this._cloudName=t.cloudName;this._columnsType=this._resourceType=t.resourceType;this._resourceTypeLower=this._resourceType.toLowerCase();this._resourceFilter=t.resourceFilter;this._searchString=this._resourceFilter.filterText;this._toolbar=t.toolbar;this._contentState=t.contentState;this._contentStateText=t.contentStateDisplayText;this._container=t.container;this._loadDataMarker=t.loadDataTelemetryEventMarker;this._scope=t.scope;this._listScope=t.listScope;this._columnsScopeType=yt.isResourceGroupId(this._listScope)&&rt.resourceGroupsTypeKey;this._onRefresh=t.onRefresh;this._excludedResourceTypes=t.excludedTypesFromBrowse;this._includeTypes=t.includeTypes;this._hasErrors=u.observable(!1);this._createPresent=!1;this._resourceTypeName="";this._resourceInstanceMap={};this._addAllowed=u.observable(
!0);this.groupByItems=u.observableArray([]);this._groupAriaLabelLookup={};this._chooseColumnsAllowed=u.observable(!1);this._deleteAllowed=u.observable(!1);this._moveAllowed=u.observable(!1);n.registerForDispose((function(){r._disposeDeleteWatcher()}));this._setContentState();this._items=u.observableArray();this.moreDataOnServer=u.observable(!1);this.itemCount=u.pureComputed((function(){return r._items().length}));this.selectedItemsCount=u.observable(0);this.addSupported=!1;this._selectedIds=u.observableArray();this._selectedAll=u.observable(!1);this._unselectedIds=u.observableArray();this._selectedBrowseItems=u.pureComputed((function(){var t=r._items(),n=r._unselectedIds(),i=function(t){return r._selectedAll()?!n.length||!n.some((function(n){return t.id===n.id})):r._selectedIds().some((function(n){return t.id===n.id}))};return t.reduce((function(n,t){return i(t)?(n.push(t),n):n}),[])}));s=this._eventWatcher=new p.ArmEventWatcher;n.registerForDispose((function(){s.disposeEventWatcher()}));f=this._resourceTypeLower===
rt.resourceGroupsTypeKey;f||this._getAssetTypes();f||this._getAssetTypes();w.getResourceTypeAssetTypeInformation(this._resourceType,this._cloudName,!0).then((function(n){r.assetTypeInfo(n)}));d.getLocationDisplayNames(this._cloudName).then((function(n){r._updateLocations(n)}));e=function(n,t){var f=r._resourceTypeLower===hr.RecentResources.toLowerCase(),u;!f&&fi(t,r._cloudName)&&(u={},di(u,n,(function(n){return n.assetId.toLowerCase()}),i.wrap(!0)),r._items().forEach((function(n){u[(n.id||"").toLowerCase()]&&fr(r._container,n,r.gridViewModel.columns)})))};o=function(n,t,u){var f,e;fi(t,r._cloudName)&&(f={},di(f,n,(function(n){return n.assetId.toLowerCase()}),i.wrap(!0)),e=r._items().slice(),i.remove(e,(function(n){return f[u(n).toLowerCase()]})),r._items(e))};this._eventWatcher.attachEventWatch(this._resourceType,{writeToResourceGroup:e,writeToResource:e,resourceGroupDeleted:function(n,t){return o(n,t,(function(n){return(f?n.id:n.resourceGroupId)||""}))},resourceDeleted:function(n,t){return o(n,t,(function(
n){return n.id||""}))}})}return n.prototype._getAssetTypes=function(){var n=this;w.getAssetTypesInformation(this._cloudName).then((function(t){t.subscribeAndRun(n._ltm,(function(t){n._updateAssetTypes(t)}))}))},n.prototype._updateAssetTypes=function(n){var t=this;n&&(this._assetTypes={},i.extendArrayIntoMap(this._assetTypes,n.filter((function(n){return!!n.resourceType})),(function(n){return n.resourceType.toLowerCase()}),i.identity));this._items().forEach((function(n){var u=n.resourceType,f=(u||"").toLowerCase(),i=f&&t._assetTypes[f],r;i&&n.needType()&&(r=i.compositeDisplayName&&i.compositeDisplayName.singular||u,n.needType(!1),n.icon(i.icon||ir),n.isPreview(n.useAssetTypePreview&&i.isPreview),n.assetType(r),n.assetTypeName(r),n.extensionName(i.extensionName||null),n.dynamicBladeService(i.dynamicBladeServiceViewModel),n.externalLink(rr(i.browseLinkUri,n.id,n.locationId)),t._checkIconAndBladeFromKind(n.id,n,i))}))},n.prototype._createFilteringComputed=function(){var n=this;u.pureComputed((function(
){return[n._getSearchString(),n._resourceFilter.selectedSubscriptions(),n._resourceFilter.selectedTypes(),n._resourceFilter.selectedLocations(),n._resourceFilter.selectedResourceGroups(),n._resourceFilter.invertResourceGroupFilter(),]})).subscribe(this._ltm,(function(){n.refresh()}))},n.prototype._getSearchString=function(){var n=(this._resourceFilter.filterText()||"").trim();return n.startsWith('"')&&n.endsWith('"')&&(n=n.substring(1,n.length-1)),n},n.prototype._createGridOptions=function(n){var t={columns:u.observableArray([]),contextMenu:{enabled:!0},scrolling:{enabled:!0,horizontal:!1},resizing:{enabled:!0}};return f.extend(t,n)},n.prototype._checkIconAndBladeFromKind=function(n,t,i,r){var u={assetTypeInformation:i,extensionName:lt(t.extensionName)};nt.checkItemKind({setIcon:t.icon,setUseResourceMenu:t.kindUseResourceMenu,setIsPreview:t.isPreview,setKindBlade:function(n,i){t.kindBlade(n);t.kindBladeExtension(i)},setAssetTypeDisplayName:function(n){r?t.assetTypeName(n):t.assetType(n)}},
n,lt(t.kind),u)},n.prototype._getSelectionPromise=function(n,t){var i=this,r,u;return n.id?(r=function(){return p.makeResourceBladePromise(i._cloudName,n.id,{sessionId:bi.sessionId,instance:y.toResourceInstance(i._resourceInstanceMap[n.id.toLowerCase()])})},p.checkNoBladeName(t))?r():n.kindUseResourceMenu()!==!1&&(ki(t,8)||n.kindUseResourceMenu()===!0&&ki(t,16))?r():n.kindBlade()?Q(gi(this._cloudName,n.kindBladeExtension(),n.kindBlade(),{id:n.id})):(u=function(){var r,u;if(nr(n.id))return r={cloudName:i._cloudName,extension:a.definitionName,assetType:vr.ResourceGroups,detailBladeInputs:wt(i._cloudName,{id:n.id})},Q(r);if(yt.isResourceId(n.id))return u={resourceId:n.id,extension:t.extensionName,cloudName:i._cloudName,detailBladeInputs:{id:n.id}},Q(u);throw new Error("Did not handle selection for model ID: "+yt.buildResourceTypeFromResourceManagerId(n.id));},n.extensionName(t.extensionName),n.dynamicBladeService(t.dynamicBladeServiceViewModel),this._getDynamicBladeSelectionPromiseForItem(
n,u)):null},n.prototype._setSelectionPromiseAndGetSelection=function(n,t){return n.dynamicBladeSelectionPromise()||n.dynamicBladeSelectionPromise(this._getSelectionPromise(n,t)),n.dynamicBladeSelectionPromise()},n.prototype._getResourceGroupSelectionPromise=function(n){return Q({selectionKey:n,extension:a.definitionName,detailBlade:br,detailBladeInputs:wt(this._cloudName,{id:n,referrerInfo:{sessionId:bi.sessionId,instance:y.toResourceInstance(this._resourceInstanceMap[n.toLowerCase()])}})})},n.prototype._createChooseColumnButton=function(){var n=this,t=new kt.OpenBladeButton2({id:"choosecolumns"+ei(),label:h.chooseColumnsCommand,icon:pt.Columns(),supplyBladeReference:function(){var t=new l.ChooseColumnsBladeReference(wt(n._cloudName,{resourceType:n._columnsType,scopeResourceType:n._columnsScopeType,subscriptions:n._getSelectedSubIds()}),function(){});return t.metadata?t.metadata.isContextBlade=!0:t.metadata={isContextBlade:!0},t}}),i=this._chooseColumnsAllowed;return i.subscribeAndRun(
this._container,(function(n){t.disabled(!n)})),t},n.prototype.getAddBlade=function(){var n=this;return p.getCreateBlade({cloudName:this._cloudName,resourceType:this._resourceType,marketplaceItemId:this._mpItemId,marketplaceMenuItemId:this._mpMenuItemId,listScope:this._listScope,listScopeLocation:this._listScopeLocation,createFlowPromise:this._createFlowPromise,onCreateFlowPromise:function(t){n._createFlowPromise=t}})},n.prototype._createAddResourceButton=function(n,t,i,r){var f=this,u;return this._mpItemId=i,this._mpMenuItemId=r,this.addSupported=!0,u=new kt.OpenBladeButton2({supplyBladeReferenceAsync:function(){return f.getAddBlade()}}),this._addAllowed.subscribeAndRun(this._container,(function(n){u.disabled(!n)})),u.id="addresource"+ei(),u.label(h.addTitle),u.icon(pt.Add()),u},n.prototype._createRefreshButton=function(){var t=this,n=new kt.CommandButton;return n.label(h.refreshCommand),n.icon(pt.Refresh()),n.command={canExecute:u.observable(!0),execute:function(){return t._onRefresh&&t._onRefresh(
),t.refresh(!0)}},n},n.prototype._createAssignTagsButton=function(){var n=this,t=new kt.OpenBladeButton2({supplyBladeReference:function(){var i=n._selectedBrowseItems().map((function(n){return n.id})),t=new l.AssignTagsBladeReference(wt(n._cloudName,{resources:i}),function(t,i){if(t===2&&i&&i.update){var r=i.update;n._items().forEach((function(t){var u=t.id||"";r[u]&&(t.tagsProperty(i.newTags[u]),ri(n._container,t,n.gridViewModel.columns))}))}});return t.metadata?t.metadata.isContextBlade=!0:t.metadata={isContextBlade:!0},t}});return t.id="assigntags"+ei(),t.label(h.assignTagsCommand),t.icon(pt.Tags()),u.reactor(this._container,(function(){t.disabled(n._selectedBrowseItems().length<1)})),t},n.prototype._createDeleteButton=function(n){var t=this,r=new kt.OpenBladeButton2({id:"deleteresourcegroup"+ei(),label:c.deleteResourceGroupCommandTitle,icon:pt.Delete(),supplyBladeReference:function(){return new o.ParameterProviderBladeReference("ResourceGroupDeleteBlade","HubsExtension",{parameters:wt(t.
_cloudName,{resourceGroup:n}),receiveResult:function(n){if(n.actionBarAction()===4){var i=new ut.ResourceGroupDeleteOperation(n.resourceGroup(),n.resourceGroupName(),t._cloudName);i.execute();t.refresh(!0)}}},{isContextBlade:!0})}}),i=this._deleteAllowed;return i.subscribeAndRun(this._container,(function(u){var f=r.disabled;u?g.Internal.hasPermission(n,[nu.deleteObject],null,t._cloudName).then((function(n){f(!(i()&&n))})).catch((function(){f(!i())})):f(!0)})),i(!1),r},n.prototype._createMoveButton=function(n){return new s.ViewModel(this._container,{resourceId:n})},n.prototype._watchResourceGroupScope=function(){var n=this,t=function(t){n._deleteAllowed(t);n._addAllowed(t);n._moveAllowed(t)},i=function(){var i=v.makeResourceManagerTelemetry("GridV2Browse.resourceGroup.checkState");tr(n._listScope,n._cloudName,i).then((function(i){if(ai(i.id,n._listScope)){n._listScopeLocation=i.location;switch((i.provisioningState||"").toLowerCase()){case"accepted":case"deleting":case"deleted":case"failed":case"movingresources":
t(!1);break;default:t(!0)}}})).catch((function(){t(!1)}))};this._disposeDeleteWatcher();this._deleteWatcherId=rt.registerResourceGroupDeleteWatcher({resourceGroupDeleteStarted:function(i,r){fi(i,n._cloudName)&&ai(r,n._listScope)&&t(!1)},resourceGroupDeleteFailed:function(t,r){fi(t,n._cloudName)&&ai(r,n._listScope)&&i()}});i()},n.prototype._getDynamicBladeSelectionPromiseForItem=function(n,t){var f=this,r,u;return n.dynamicBladeService()?(r=ui.getViewModelsDefinition.acquireObject(cr.client,ui.getWindowId({name:n.extensionName(),cloudName:this._cloudName}),{type:oi.ViewModelTypes.ViewModel,name:n.dynamicBladeService(),initialState:null,createSelectable:!1}),u=r.then((function(r){var o=r.getValue(),u=o.content,e;return typeof u.onInputsSet!="function"?(li.warning("Dynamic blade service had no onInputsSet."),r.dispose(),t()):(e=u.onInputsSet({assetId:n.id,usage:lr.Usage.DynamicAssetSelection}),Q(e||!0).then((function(){var i=u.bladeName();return i?Q(gi(f._cloudName,u.extensionName()||n.extensionName(
),i,{id:n.id})):t()})).catch((function(){return li.warning("The onInputsSet promise for the dynamic blade service was rejected."),t()})).finally((function(){i.disposeViewModelProperties(r.getValue());r.dispose()})))})).catch((function(){return li.error("Failed to get the dynamic blade service during browse."),t()})),u):t()},n.prototype._getSelectedSubIds=function(){return v.filterSubscriptionsByScope(this._resourceFilter.selectedSubscriptions().map((function(n){return n.subscriptionId})),this._scope)},n.prototype._setContentState=function(n){var t=this._contentState,i=this._contentStateText;this._hasErrors()||n?(t(2),i(h.browseResourcesError)):this._createPresent?(t(5),i(h.createCompletionMessage.format(this._resourceTypeName))):(t(0),i(null))},n.prototype._initializeCreateListener=function(){var n=this,t=it.subscribeToArmEvent({source:"microsoft.resources",operationNameRegex:"microsoft.resources/subscriptions/resourcegroups/deployments/write",status:"succeeded"},(function(t){var i=n._getSelectedSubIds(
);t.forEach((function(t){var r=t.properties&&t.properties.subscriptionId;r&&i.indexOf(r.toLowerCase())===-1||(n._createPresent=!0,n._setContentState())}))}));this._container.registerForDispose((function(){it.removeArmEventSubscription(t)}))},n.prototype._getResourceColumns=function(n){var i=this,t;return n===void 0&&(n=!0),t=[at(11,ct.AssetType),{id:ii[3],name:ct.ResourceGroup.title,visible:!0,dynamicSelectionProvider:function(n,t){var r=i._getResourceGroupSelectionPromise(lt(t.resourceGroupId));return r.then((function(n){i._logActivation(t.id,n,"resourceGroup")})),r},activatable:!0},at(4,ct.Location),at(9,ct.Subscription),at(2,ct.Kind,!0),at(7,ct.ResourceGroupId,!0),at(5,ct.LocationId,!0),at(6,ct.ResourceId,!0),at(8,ct.ResourceType,!0),at(10,ct.SubscriptionId,!0)],tt.tagsV2Enabled&&t.push(vi(!0)),n||(t[1].visible=!1,t[3].visible=!1),t},n.prototype._getTenantResourceColumns=function(){var n=[at(11,ct.AssetType),at(4,ct.Location),at(2,ct.Kind,!0),at(5,ct.LocationId,!0),at(6,ct.ResourceId,!0),at(
8,ct.ResourceType,!0)];return tt.tagsV2Enabled&&n.push(vi(!0)),n},n.prototype._getResourceGroupColumns=function(){var n={svg:dt.Unknown(),text:gt.notSpecified},t={svg:dt.Pending(),text:gt.accepted},i={svg:dt.Warning(),text:gt.deleting},r={svg:dt.Disabled(),text:gt.deleted},u={svg:dt.Failed(),text:gt.failed},f={svg:dt.Pending(),text:gt.movingResources},e={svg:dt.Success(),text:gt.succeeded},o=[at(9,ct.Subscription),at(4,ct.Location),at(5,ct.LocationId,!0),at(7,ct.ResourceGroupId,!0),at(10,ct.SubscriptionId,!0),{id:"status",name:ct.Status.title,visible:!1,format:new yr.SvgIconLookup({svgIconLookup:{"##DEFAULT##":n,notspecified:n,NotSpecified:n,accepted:t,Accepted:t,deleting:i,Deleting:i,deleted:r,Deleted:r,failed:u,Failed:u,movingresources:f,MovingResources:f,succeeded:e,Succeeded:e},width:"16px",height:"16px"}),description:h.Columns.Status.description}];return tt.tagsV2Enabled&&o.push(vi(!0)),o},n.prototype._logPrimaryDataLoadedTelemetry=function(n){this._loadDataMarker&&si.endTrace(this.
_loadDataMarker,si.ActionModifier.Complete,{resourceType:this._resourceType,rows:n});this._loadDataMarker=null},n.prototype._logActivation=function(n,t,i){si.trace({action:tu,extension:t.extension,source:kr,data:{assetId:n,detailBlade:t.detailBlade,detailBladeExtension:t.extension,column:i}})},n.prototype._createBrowseResourceItemFromResource=function(n,t,i,r){var a=this,e=lt(n.id);this._resourceInstanceMap[e.toLowerCase()]=u.toJS(n);var o=lt(n.location),v=yt.parseResourceDescriptor(e),c=lt(n.type),y=c.toLowerCase(),f=this._assetTypes[y]||i[y]||{},p=u.observable(f.compositeDisplayName&&f.compositeDisplayName.singular||c),w=er(v.subscription,this._cloudName),l=lt(n.tags),b=l&&l["hidden-title"]?n.name+" "+h.hiddenTitle.format(n.tags["hidden-title"]):n.name,s={icon:u.observable(f.icon||ir),name:(b||n.id||"unknown").split("/").last(),browse_cloudName:this._cloudName,isPreview:u.observable(t&&f.isPreview),subscription:w.uniqueDisplayName,location:u.observable(this._locationDisplayMap&&o&&this.
_locationDisplayMap[o.toLowerCase()]||o),locationId:o,resourceGroup:v.resourceGroup,kind:u.observable(lt(n.kind)),kindUseResourceMenu:u.observable(),assetType:p,assetTypeName:p,resourceId:e,resourceType:c,resourceGroupId:yt.buildResourceGroupIdFromResourceId(e),subscriptionId:w.subscriptionId,tagsProperty:u.observable(l),tags:u.observable({}),tagsArray:null,id:e,supplemental:r&&u.observable(r),extensionName:u.observable(f.extensionName||null),dynamicBladeService:u.observable(f.dynamicBladeServiceViewModel),dynamicBladeSelectionPromise:u.observable(),externalLink:u.observable(rr(f.browseLinkUri,e,o)),kindBlade:u.observable(),kindBladeExtension:u.observable(),needType:u.observable(!f.assetType),useAssetTypePreview:t};return s.tagsArray=yi(this._container,s,this.gridViewModel.columns),this.gridViewModel.columns.subscribeAndRun(this._container,(function(){ri(a._container,s,a.gridViewModel.columns)})),this._checkIconAndBladeFromKind(e,s,f),wt(this._cloudName,s)},n.prototype._createBrowseResourceGroupItemFromResourceGroup=
function(n){var f=this,i=lt(n.id);this._resourceInstanceMap[i.toLowerCase()]=u.toJS(n);var r=lt(n.location),e=yt.parseResourceGroupDescriptor(i),o=er(e.subscription,this._cloudName),s=lt(n.tags),t={icon:u.observable(wi.ResourceGroup()),name:lt(n.name),browse_cloudName:this._cloudName,subscription:o.uniqueDisplayName,location:u.observable(this._locationDisplayMap&&r&&this._locationDisplayMap[r.toLowerCase()]||r),locationId:lt(n.location),resourceGroupId:yt.buildResourceGroupIdFromDescriptor(e),subscriptionId:o.subscriptionId,status:u.observable(lt(n.provisioningState)),tagsProperty:u.observable(s),tags:u.observable({}),tagsArray:null,id:i};return t.tagsArray=yi(this._container,t,this.gridViewModel.columns),this.gridViewModel.columns.subscribeAndRun(this._container,(function(){ri(f._container,t,f.gridViewModel.columns)})),wt(this._cloudName,t)},n.prototype._performGetResources=function(n,t){var r=this,u;return this._prevLtm&&this._prevLtm.dispose(),u=this._prevLtm=this._ltm.createChildLifetime(
),i.tryImmediateResolve(n,(function(n){return ni.Promises.cancelOnDispose(u,n.getResources(u,t)).then((function(n){t.partialErrors()&&r._setContentState(!0);var i=n.subscribe(u,(function(n){var t=n.length,i=t>2e3,u=i?n.slice(0,2e3):n;r._logPrimaryDataLoadedTelemetry(t);r._items(u.map((function(n){return r._makeBrowseItem(n)})));r.moreDataOnServer(i);r.loaded(!0)}));n().length&&i.callback(n())}))}))},n.prototype._performRefresh=function(n){var t=this;return this.gridViewModel.loading(!0),this._hasErrors(!1),this._createPresent=!1,Q(n).then((function(){t._setContentState()})).catchError(i.Errors.CanceledError,(function(){})).catch((function(){t._hasErrors(!0);t._setContentState()}))},n.prototype._updateLocations=function(n){n&&(this._locationDisplayMap=n);n=this._locationDisplayMap;n&&this._items&&this._items().forEach((function(t){var i=t.locationId;i&&t.location(n[i.toLowerCase()]||i)}))},n.prototype._buildResourceSelection=function(n,t){var i=this;return w.getResourceTypeAssetTypeInformation(t.resourceType,
this._cloudName,!0).then((function(r){var u=i._excludedResourceTypes&&i._excludedResourceTypes[t.resourceType.toLowerCase()],e=t.kind()&&t.kind().toLowerCase(),f,o=i._includeTypes();return f=o&&(u===!0||u&&u[e]===!0)||!r?b.addCloudNameToDynamicSelection(i._cloudName,hi.getBladeSelection(i._cloudName,a.definitionName,a.BladeNames.resourceMenuBlade,{id:t.resourceId})):i._setSelectionPromiseAndGetSelection(t,r),f.then((function(t){i._logActivation(n,t)})),f}))},n.prototype._createBulkCommands=function(n,t){var i=this,r=[],f;return n.forEach((function(n){var e=wr.tooltip.format(n.label),o,s;n.confirmWithTextInput?r.push(i._createBulkDeleteButton(n,e)):(f||(f=u.computed(i._ltm,(function(){return i.selectedItemsCount()>0}))),o=new ar.MessageBox(n.confirmationTitle,n.confirmationMessage,4),s=new kt.DialogButton({name:"{0}.BulkCmd.{1}".format(i._resourceType,n.id),label:n.label,icon:n.icon,tooltip:e,dialogOptions:o,command:new ot.BulkCommandImpl(i._ltm,n,i._cloudName,{resourceType:i._resourceType,hasSelectedItems:
f,selectedBrowseItems:i._selectedBrowseItems,onCompleteCallback:t})}),r.push(s))})),r},n.prototype._createBulkDeleteButton=function(n,t){var i=this,r=new kt.OpenBladeButton2({label:n.label,icon:n.icon,tooltip:t,supplyBladeReference:function(){var r=[],u=i._selectedBrowseItems().length,t;return u<=et.MaxBatchDeleteResources&&(r=i._selectedBrowseItems().map((function(n){return{name:n.name,resourceId:n.resourceId,resourceType:n.resourceType.toLowerCase(),assetType:n.assetType(),icon:n.icon()}}))),t=new l.BulkDeleteBladeReference(wt(i._cloudName,{resources:r,commandDefinition:n,resourceType:i._resourceType,resourceInfoCount:u})),t.metadata?t.metadata.isContextBlade=!0:t.metadata={isContextBlade:!0},t}});return r.name=r.id="{0}.BulkCmd.{1}".format(this._resourceType,n.id),u.reactor(this._container,(function(){r.disabled(!(i.selectedItemsCount()>0))})),r},n.prototype._disposeDeleteWatcher=function(){var n=this._deleteWatcherId;n&&rt.unregisterResourceGroupDeleteWatcher(n);this._deleteWatcherId=null}
,n})();t.BaseConfiguration=or}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/BrowseBulkCommandConfig",["require","exports","f","HubsExtension/Browse/BrowseClientStrings"],(function(n,t,i,r){"use strict";var u;return (function(n){function o(n){return t.confirmCommand.format(n.toLowerCase())}var u=i.Base.Images,t=r.BulkCommand,s="api-version=2015-06-01",h="api-version=2016-08-01",c="api-version=2016-03-30",l="api-version=2016-04-30-preview",a="api-version=2015-12-01",v="api-version=2016-06-01",f=t.confirmDeleteDescription,p=t.confirmStopVirtualMachineScaleSets,y=o(t.start),w=o(t.stop),b=o(t.restart),e=o(t.delete),g=o(t.enable),nt=o(t.disable),k={"microsoft.compute/virtualmachines":{type:"DELETE",uri:"{resourceid}?"+c,isDeleteOperation:!0,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}},"microsoft.classiccompute/virtualmachines":{type:"DELETE",uri:"{resourceid}?keep-disks=true&"+a,isDeleteOperation:!0,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}}},
d={"microsoft.web/sites":{type:"DELETE",uri:"{resourceid}?deleteEmptyServerFarm=false&"+h,isDeleteOperation:!0}};n.AllResourcesCommandDefinition=[{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.resources,t.confirmDeleteAllResources),confirmWithTextInput:!0,armCommandDefinitions:i.extend2({"*":{type:"DELETE",uri:null,isDeleteOperation:!0}},k,d)}];n.VirtualMachineCommandDefinition=[{id:"BulkStart",label:t.start,icon:u.Start(),confirmationMessage:y,armCommandDefinitions:{"microsoft.compute/virtualmachines":{uri:"{resourceid}/start?"+c,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}},"microsoft.classiccompute/virtualmachines":{uri:"{resourceid}/start?"+a,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}}}},{id:"BulkRestart",label:t.restart,icon:u.Redo(),confirmationMessage:b,armCommandDefinitions:{"microsoft.compute/virtualmachines":{uri:"{resourceid}/restart?"+c,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}},
"microsoft.classiccompute/virtualmachines":{uri:"{resourceid}/restart?"+a,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}}}},{id:"BulkStop",label:t.stop,icon:u.Stop(),confirmationMessage:w,armCommandDefinitions:{"microsoft.compute/virtualmachines":{uri:"{resourceid}/deallocate?"+c,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}},"microsoft.classiccompute/virtualmachines":{uri:"{resourceid}/shutdown?"+a,asyncOperation:{pollingHeaderOverride:"Azure-AsyncOperation"}}}},{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.virtualMachines,t.confirmDeleteVirtualMachines),confirmWithTextInput:!0,armCommandDefinitions:k}];n.VirtualMachineScaleSetsCommandDefinition=[{id:"BulkStart",label:t.start,icon:u.Start(),confirmationMessage:y,armCommandDefinitions:{"microsoft.compute/virtualmachinescalesets":{uri:"{resourceid}/start?"+l}}},{id:"BulkRestart",label:t.restart,icon:u.Redo(),confirmationMessage:p.format(t.restart.toLowerCase(
)),armCommandDefinitions:{"microsoft.compute/virtualmachinescalesets":{uri:"{resourceid}/restart?"+l}}},{id:"BulkStop",label:t.stop,icon:u.Stop(),confirmationMessage:p.format(t.stop.toLowerCase()),armCommandDefinitions:{"microsoft.compute/virtualmachinescalesets":{uri:"{resourceid}/deallocate?"+l}}},{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.virtualMachineScaleSets,t.confirmDeleteVirtualMachineScaleSets),confirmWithTextInput:!0,armCommandDefinitions:{"microsoft.compute/virtualmachinescalesets":{type:"DELETE",uri:"{resourceid}?"+l,isDeleteOperation:!0}}}];n.CloudServicesCommandDefinition=[{id:"BulkStartProduction",label:t.startProduction,icon:u.Start(),confirmationMessage:t.confirmStartProdCloudServices,armCommandDefinitions:{"microsoft.classiccompute/domainnames":{uri:"{resourceid}/slots/production/start?"+s}}},{id:"BulkStopProduction",label:t.stopProduction,icon:u.Stop(),confirmationTitle:t.confirmStopProdCloudServicesTitle,confirmationMessage:
t.confirmBillingInfo,armCommandDefinitions:{"microsoft.classiccompute/domainnames":{uri:"{resourceid}/slots/production/stop?"+s}}},{id:"BulkStartStaging",label:t.startStaging,icon:u.Start(),confirmationMessage:t.confirmStartStagingCloudServices,armCommandDefinitions:{"microsoft.classiccompute/domainnames":{uri:"{resourceid}/slots/staging/start?"+s}}},{id:"BulkStopStaging",label:t.stopStaging,icon:u.Stop(),confirmationTitle:t.confirmStopStagingCloudServicesTitle,confirmationMessage:t.confirmBillingInfo,armCommandDefinitions:{"microsoft.classiccompute/domainnames":{uri:"{resourceid}/slots/staging/stop?"+s}}},{id:"BulkSwap",label:t.swap,icon:u.Swap(),confirmationMessage:t.confirmSwapCloudServices,armCommandDefinitions:{"microsoft.classiccompute/domainnames":{uri:"{resourceid}/swap?"+s}}},{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.cloudServices,t.confirmDeleteCloudServices),confirmWithTextInput:!0,armCommandDefinitions:{"microsoft.classiccompute/domainnames":
{type:"DELETE",uri:"{resourceid}?force=true&"+s,isDeleteOperation:!0}}}];n.AppServiceCommandDefinition=[{id:"BulkStart",label:t.start,icon:u.Start(),confirmationMessage:y,armCommandDefinitions:{"microsoft.web/sites":{uri:"{resourceid}/start?"+h}}},{id:"BulkRestart",label:t.restart,icon:u.Redo(),confirmationMessage:b,armCommandDefinitions:{"microsoft.web/sites":{uri:"{resourceid}/restart?"+h}}},{id:"BulkStop",label:t.stop,icon:u.Stop(),confirmationMessage:w,armCommandDefinitions:{"microsoft.web/sites":{uri:"{resourceid}/stop?"+h}}},{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.webApps,t.confirmDeleteAppService),confirmWithTextInput:!0,armCommandDefinitions:d}];n.StorageCommandDefinition=[{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.storage,t.confirmDeleteStorage),confirmWithTextInput:!0,armCommandDefinitions:{"microsoft.storage/storageaccounts":{type:"DELETE",uri:"{resourceid}?api-version=2015-06-15",
isDeleteOperation:!0},"microsoft.classicstorage/storageaccounts":{type:"DELETE",uri:"{resourceid}?api-version=2015-12-01",isDeleteOperation:!0}}}];n.SqlDatabasesCommandDefinition=[{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.databases,t.confirmDeleteDatabases),confirmWithTextInput:!0,armCommandDefinitions:{"microsoft.sql/servers/databases":{type:"DELETE",uri:"{resourceid}?api-version=2014-04-01-preview",isDeleteOperation:!0}}}];n.LogicAppsCommandDefinition=[{id:"BulkEnable",label:t.enable,icon:u.Signout(),confirmationMessage:g,armCommandDefinitions:{"microsoft.logic/workflows":{uri:"{resourceid}/enable?"+v}}},{id:"BulkDisable",label:t.disable,icon:u.Disable(),confirmationMessage:nt,armCommandDefinitions:{"microsoft.logic/workflows":{uri:"{resourceid}/disable?"+v}}},{id:"BulkDelete",label:t.delete,icon:u.Delete(),confirmationTitle:e,confirmationMessage:f.format(t.logicApps,t.confirmDeleteLogicApps),confirmWithTextInput:!0,armCommandDefinitions:
{"microsoft.logic/workflows":{type:"DELETE",uri:"{resourceid}?"+v,isDeleteOperation:!0}}}];n.BulkCommandDefinitions={"microsoft.resources/resources":n.AllResourcesCommandDefinition,"microsoft.compute/virtualmachines":n.VirtualMachineCommandDefinition,"microsoft.classiccompute/virtualmachines":n.VirtualMachineCommandDefinition,"microsoft.compute/virtualmachinescalesets":n.VirtualMachineScaleSetsCommandDefinition,"microsoft.classiccompute/domainnames":n.CloudServicesCommandDefinition,"microsoft.web/sites":n.AppServiceCommandDefinition,"microsoft.storage/storageaccounts":n.StorageCommandDefinition,"microsoft.classicstorage/storageaccounts":n.StorageCommandDefinition,"microsoft.sql/servers/databases":n.SqlDatabasesCommandDefinition,"microsoft.logic/workflows":n.LogicAppsCommandDefinition}})(u||(u={})),u}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/All",["require","exports","f","ko","FxInternal/Controls/Grid2/GridB","FxInternal/Data/GroupNavigator","HubsExtension/Browse/BrowseClientStrings",
"HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResource","HubsExtension/Browse/BrowseArea","HubsExtension/Common/AssetTypeCache","HubsExtension/HubsCommon","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Base","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/BrowseBulkCommandConfig"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";var w=i.Base,b=w.Constants,p=i.ViewModels,y=p.Services.ResourceTypes,k=r.utils.peekObservable,d=(function(n){function t(t,i){var u=this,f;n.call(this,t,i);this._assetTypeInfoMap={};this._options=i;f=y.isResourceGroupId(this._listScope)||y.isResourceGroupId(this._scope)?[{text:e.GroupBy.noGrouping,value:""},{text:e.GroupBy.assetType,value:"assetType"},{text:e.GroupBy.location,value:"location"}]:y.isSubscriptionId(this._listScope)||y.isSubscriptionId(this._scope)?[{text:e.GroupBy.noGrouping,value:""},{text:e.GroupBy.resourceGroup,value:"resourceGroup"},{text:e.GroupBy.assetType,value:"assetType"},{text:e.
GroupBy.location,value:"location"}]:[{text:e.GroupBy.noGrouping,value:""},{text:e.GroupBy.resourceGroup,value:"resourceGroup"},{text:e.GroupBy.assetType,value:"assetType"},{text:e.GroupBy.subscription,value:"subscription"},{text:e.GroupBy.location,value:"location"}];this.groupByItems(f);this._groupAriaLabelLookup.resourceGroup=e.Aria.Group.resourceGroupDescription;this._groupAriaLabelLookup.assetType=e.Aria.Group.assetTypeDescription;this._groupAriaLabelLookup.subscription=e.Aria.Group.subscriptionDescription;this._groupAriaLabelLookup.location=e.Aria.Group.locationDescription;l.bulkCommandsEnabled&&r.reactor(this._ltm,(function(){u.selectedItemsCount(u._selectedBrowseItems().length)}))}return __extends(t,n),t.prototype._fetchData=function(){var t=this,n={sourceHandler:function(i,r,u,f){var e=function(n){return u.matchSubscription(n)};return(r||[]).forEach((function(i){if(y.isResourceId(i.id)){var r=i;t._options.includeTypes()?h.showResource(r,n,e)&&f.push(s.toResource(r)):t._assetTypeInfoMap[
r.type.toLowerCase()]&&h.showResource(r,n,e)&&f.push(s.toResource(r))}})),f.length<2e3},loading:this.gridViewModel.loading,partialErrors:this._hasErrors,cloudName:this._cloudName,scope:this._scope,excludedResourceTypes:!this._options.includeTypes()&&this._excludedResourceTypes,filter:this._getSearchString(),selectedSubscriptions:this._resourceFilter.selectedSubscriptions,selectedTypes:this._resourceFilter.selectedTypes(),selectedResourceGroups:this._resourceFilter.selectedResourceGroups(),invertResourceGroupFilter:this._resourceFilter.invertResourceGroupFilter(),selectedLocations:this._resourceFilter.selectedLocations(),telemetry:o.makeResourceManagerTelemetry("GridV2Browse.all")};return this._performGetResources(Q(new h.AllResourcesSource),n)},t.prototype._makeBrowseItem=function(n){if(y.isResourceId(n.id))return this._createBrowseResourceItemFromResource(n,!0,this._assetTypeInfoMap,{})},t.prototype.loadData=function(){var n=this,t,i,r;return this._resourceInstanceMap={},t=this._assetTypeInfoMap,
i=function(n){var i=n.lowerCaseResourceType;i&&(t[i]=n)},this._chooseColumnsAllowed(!0),r=c.getAssetTypesInformation(this._cloudName).then((function(t){t.subscribeAndRun(n._ltm,(function(n){n.forEach((function(n){i(n)}))}))})),r.then((function(){n._resourceTypeName=e.AssetTypeNames.AllResource.lowerPlural;var t=n._resourceFilter.subscriptionsLoaded;t.fxOnceAndRun(n._ltm,(function(){n._createFilteringComputed();n._fetchData()}))}))},t.prototype.createGridViewModel=function(){var n=this,h=new f(this._ltm,{sourceItems:this._items,getId:function(n){return k(n.id)},groupBy:this.groupBy,compare:a.browseCompare}),c=this._createGridOptions({dataNavigator:h,selection:{dynamicSelectionProvider:this._buildResourceSelection.bind(this),activationMode:2,selectionMode:l.tagsV2Enabled||l.bulkCommandsEnabled?3:2,selectedIds:this._selectedIds,unselectedIds:this._unselectedIds,selectedAll:this._selectedAll,hiddenInCollapsed:!0,linkUriProperty:"externalLink",activationContainer:this._container},resizing:{resizeToPercent:
r.observable(!0)},sorting:{enabled:!0},ariaLabel:e.Aria.allDescription,getRowAriaLabel:function(n){return e.Aria.rowDescription.format(n.name,e.AssetTypeNames.AllResource.lowerSingular)},grouping:{enabled:!0,groupBy:this.groupBy,getGroupAriaLabel:function(t){return n._groupAriaLabelLookup[n.groupBy()]&&n._groupAriaLabelLookup[n.groupBy()].format(t)}}}),s;this.gridViewModel=new u.ViewModel(this._ltm,c);var t=this._columnsType,i=this._columnsScopeType,o=this._getResourceColumns(!this._listScope);this._columnContext.setDefaultBrowseColumns(t,i,o);s=this._columnContext.getVisibleBrowseColumns(t,i);s.subscribeAndRun(this._ltm,(function(t){var u=t||o,i=[a.getNameColumn(),];u.forEach((function(n){n&&n.visible&&i.push({id:n.itemKey||n.id,name:r.observable(n.name),format:n.format,dynamicSelectionProvider:n.dynamicSelectionProvider,activatable:n.activatable,width:r.observable("100px"),hiddenInCollapsed:!0,sortable:!0})}));n.gridViewModel.columns(i)}));this.gridViewModel.loading(!0)},t.prototype.populateCommandBar=
function(){var n=[],t=this._options.allowOperations,i,r,u,f;t&&n.push(this._createAddResourceButton(this._ltm,this._resourceType,null,b.GalleryMenuItems.HomeMenuItem));n.push(this._createChooseColumnButton());i=this._createRefreshButton();t&&y.isResourceGroupId(this._listScope)?(n.push(this._createDeleteButton(this._listScope),i,this._createMoveButton(this._listScope)),l.tagsV2Enabled&&(n.push(new p.Toolbars.Separator),n.push(this._createAssignTagsButton())),this._watchResourceGroupScope()):(n.push(i),r=!1,t&&l.tagsV2Enabled&&(n.push(new p.Toolbars.Separator),n.push(this._createAssignTagsButton()),r=!0),u=v.BulkCommandDefinitions[this._resourceType.toLowerCase()],l.bulkCommandsEnabled&&u&&(r||n.push(new p.Toolbars.Separator),f=this._createBulkCommands(u),n.push.apply(n,f)));this._toolbar.setItems(n)},t.prototype.refresh=function(){return this._performRefresh(this._fetchData())},t})(a.BaseConfiguration);t.BrowseAllConfiguration=d}));define("HubsExtension/BrowseGrid2/BrowseBlades/ViewModels/RecentResourceCommands",
["require","exports","f","i","ko","HubsExtension/Common/RecentResources"],(function(n,t,i,r,u,f){"use strict";var e;return (function(n){var e=i.Base,o=e.Images,s=r.Extension.CloudName,h=i.ViewModels,c=(function(n){function t(){n.call(this);this.icon(o.Discard())}return __extends(t,n),t.prototype.onInputsSet=function(n){if(!n.id){this.enabled(!1);return}this._cloudName=s.readFromInputs(n);this._id=n.id;return},t.prototype.execute=function(){this.enabled(!1);f.getRecentsManager().removeRecent(this._cloudName,this._id)},t})(h.Command),t;n.DiscardRecentResourceCommand=c;t=(function(){function n(n){this.canExecute=u.pureComputed(n)}return n.prototype.execute=function(){return f.getRecentsManager().clear()},n})();n.ClearRecentResourcesCommand=t})(e||(e={})),e}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Recent",["require","exports","f","i","ko","FxInternal/Controls/Grid2/GridB","FxInternal/Data/GroupNavigator","HubsExtension/Browse/BrowseClientStrings","HubsExtension/_generated/ExtensionDefinition",
"HubsExtension/Common/RecentResources","HubsExtension/BrowseGrid2/BrowseBlades/ViewModels/RecentResourceCommands","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Base"],(function(n,t,i,r,u,f,e,o,s,h,c,l){"use strict";var a;return (function(n){var a=i.Base,v=r.Extension.CloudName,y=i.ViewModels,p=y.Toolbars,t=window,w=u.utils.peekObservable,b=6e4,k=(function(n){function y(){n.apply(this,arguments)}return __extends(y,n),y.prototype.loadData=function(){return null},y.prototype.createGridViewModel=function(){var n=this;this._ltm.registerForDispose((function(){n._cancelTimer()}));this._recentExistingModelCache={};this._lastPopulationIndex=0;var i={sourceItems:this._items,getId:function(n){return w(n.id)}},r=new e(this._ltm,i),c=this._createGridOptions({dataNavigator:r,columns:u.observableArray([l.getNameColumn(),{id:"assetTypeName",name:u.observable(o.Columns.AssetType.title),hiddenInCollapsed:!0,width:u.observable("100px")},{id:"timeStamp",name:u.observable(o.Columns.LastAccess.title),
hiddenInCollapsed:!0,width:u.observable("100px")},]),selection:{dynamicSelectionProvider:function(t,i){return i.dynamicBladeSelectionPromise()||i.dynamicBladeSelectionPromise(n._getSelectionPromise(i,i.assetTypeInformation)),i.dynamicBladeSelectionPromise().then((function(t){n._logActivation(i.id,t)})),i.dynamicBladeSelectionPromise()},activationMode:2,commandGroupProvider:function(){return Q([{id:s.CommandGroupNames.recentResourceBrowseGrid2Commands},])},activationContainer:this._container},resizing:{resizeToPercent:u.observable(!0)},ariaLabel:o.Aria.recentsDescription,getRowAriaLabel:function(n){return o.Aria.rowDescription.format(n.name,o.AssetTypeNames.AllResource.lowerSingular)}});this.gridViewModel=new f.ViewModel(this._ltm,c);this.gridViewModel.noRowsMessage(o.NoResources.base.format(o.AssetTypeNames.RecentResource.lowerPlural));this._recentsView=h.getRecentsManager().recentsList;this._recentsView.subscribeAndRun(this._ltm,(function(){return n._populate()}));this._resourceTypeName=o.
AssetTypeNames.RecentResource.lowerPlural;this._createFilteringComputed();this._refreshTimer=t.setTimeout((function(){n._recentsView().forEach((function(t){var i=n._recentExistingModelCache[t.key];i&&i.timeStamp(new Date(t.timeStamp).toRelativeString())}))}),b)},y.prototype._populate=function(){var n=this,t=this._recentsView()||[],f,e;this._resourceInstanceMap={};f=++this._lastPopulationIndex;f>=this._lastPopulationIndex&&(e=t.filter((function(t){return r.Extension.isEqualCloudName(t.cloudName,n._cloudName)})).map((function(t){var r=t.assetTypeInformation||{},o=r.compositeDisplayName&&r.compositeDisplayName.singular,e=n._recentExistingModelCache[t.key],f;return e?(e.timeStamp(new Date(t.timeStamp).toRelativeString()),i.clone(e)):(f=v.addToModel(t.cloudName,{icon:u.observable(r.icon),name:t.name,browse_cloudName:n._cloudName,isPreview:u.observable(r.isPreview),kind:u.observable(t.resourceKind),kindUseResourceMenu:u.observable(),timeStamp:u.observable(new Date(t.timeStamp).toRelativeString()),assetTypeName:
u.observable(o),id:t.resourceId,extensionName:u.observable(r.extensionName),assetType:u.observable(r.assetType),assetTypeInformation:r,dynamicBladeService:u.observable(r.dynamicBladeServiceViewModel),dynamicBladeSelectionPromise:u.observable(),kindBlade:u.observable(),kindBladeExtension:u.observable()}),n._checkIconAndBladeFromKind(t.resourceId,f,r,!0),n._recentExistingModelCache[t.key]=f,f)})).filter((function(t){return n._searchString()?t.name.toLowerCase().indexOf(n._searchString().toLowerCase())!==-1:!0})),this._items(e));this._hasErrors(!1);this._setContentState();this._logPrimaryDataLoadedTelemetry(t.length)},y.prototype._makeBrowseItem=function(){throw new Error("Should not have called makeBrowseItem for recent?");},y.prototype.populateCommandBar=function(){var t=this,n=new p.CommandButton;n.command=new c.ClearRecentResourcesCommand(function(){return t._items().length>0});n.icon(a.Images.Delete());n.label(o.clearRecentsCommand);this._toolbar.setItems([n])},y.prototype.refresh=function(
){return this._populate(),Q()},y.prototype._cancelTimer=function(){this._refreshTimer&&t.clearTimeout(this._refreshTimer);this._refreshTimer=0},y})(l.BaseConfiguration);n.BrowseRecentConfiguration=k})(a||(a={})),a}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Resource",["require","exports","f","i","a","ko","FxInternal/Controls/Grid2/GridB","FxInternal/Data/GroupNavigator","HubsExtension/Browse/BrowseClientStrings","MsPortalFx/Globalization","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResource","HubsExtension/Browse/BrowseArea","HubsExtension/Common/AssetTypeCache","HubsExtension/Common/AssetViewModelCommon","HubsExtension/HubsCommon","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Base","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/BrowseBulkCommandConfig"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){"use strict";function kt(n,t){var i=Q.defer(),r=i.promise;return t.subscribeAndRun(n,(function(t){t!==et&&
(i&&i.resolve(t),i=null,n&&n.dispose(),n=null)})),r}function dt(n){var t;switch(n.format){case d.CustomDate:t=new k.Date({dateFormat:n.formatOptions.dateFormat});break;case d.Html:t=new k.Html;break;case d.HtmlBindings:t=new k.HtmlTemplate({template:n.formatOptions.htmlBindingsTemplate});break;case d.Icon:t=new k.Icon;break;case d.IconLookup:t=new k.IconLookup({iconLookup:n.formatOptions.iconLookup});break;case d.LongDate:t=new k.Date({dateFormat:h.DateTimeFormat.longDatePattern});break;case d.LongTime:t=new k.Date({dateFormat:h.DateTimeFormat.longTimePattern});break;case d.MonthDay:t=new k.Date({dateFormat:h.DateTimeFormat.monthDayPattern});break;case d.Number:t=new k.Number({numberFormat:n.formatOptions.numberFormat});break;case d.ShortDate:t=new k.Date({dateFormat:h.DateTimeFormat.shortDatePattern});break;case d.ShortTime:t=new k.Date({dateFormat:h.DateTimeFormat.shortTimePattern});break;case d.SvgIcon:t=new k.SvgIcon;break;case d.SvgIconLookup:t=new k.SvgIconLookup({svgIconLookup:n.
formatOptions.svgIconLookup});break;case d.Text:t=new k.Text;break;case d.TextLookup:t=new k.TextLookup({textLookup:n.formatOptions.textLookup});break;case d.Uri:t=new k.Uri;break;case d.YearMonth:t=new k.Date({dateFormat:h.DateTimeFormat.yearMonthPattern});break;default:t=new k.Text}return{id:"supplemental."+n.itemKey,name:n.name,format:t,hiddenInCollapsed:!0,width:f.observable("100px"),sortable:!1,activatable:n.activatable,dynamicSelectionProvider:function(t,i){return n.dynamicSelectionProvider&&n.dynamicSelectionProvider()(t,i)}}}var vt=i.Base,ot=vt.Diagnostics,st=ot.Telemetry,tt=i.ViewModels,ht=tt.Controls,d=tt.Controls.Lists.Grid.Format,it=tt.Services.ResourceTypes,rt=i.Assets,g=i.Extension.ResourceRoutingType,k=r.ViewModels.Controls.Lists.Grid2.Formatters,yt=tt.Internal,pt=r.ViewModels.Controls.Lists,nt=ot.createLog(n),et={},ut=new Error("lifetime manager disposed."),ct=f.utils.peekObservable,ft=it.compareResourceId,lt=w.mapColumnIdToString(9),at=6,wt=500,bt=10,gt=(function(n){function t(
t,r){var u=this,l;n.call(this,t,r);this._supplementalDataLifetime={};this._pendingSupplementalDataRequest={};this._activeSupplementalDataRequest={};this._commandGroup={};this._commandGroupOwner={};this._supplementalColumns=f.observable([]);this._currentSupplementalColumnIds=[];this._supplementalColumnsDeferred=Q.defer();this._defaultVisibleColumns=f.observable([]);this._titleObservable=r.titleObservable;this._showTextFilter=r.showTextFilter;this._showSubscriptionFilter=r.showSubscriptionFilter;this._showTypeFilter=r.showTypeFilter;this._showResourceGroupFilter=r.showResourceGroupFilter;this._showLocationFilter=r.showLocationFilter;this._showSubscriptionSummary=r.showSubscriptionSummary;this._showTenantLevelSubscriptionSummary=r.showTenantLevelSubscriptionSummary;this._infoBox=r.infoBox;this._kindFilter=r.kindFilter;this._isCollapsible=r.isCollapsible;this._needSupplementalData=!0;this._assetTypeInfoMap={};this._allowOperations=r.allowOperations;var a=this._assetTypeInfoMap,h=function(n)
{var t=n.lowerCaseResourceType;t&&(a[t]=n)},e=Q.defer(),o=this._assetInfoPromise=e.promise,y=0,c=function(){v.getMergedResourceTypeAssetTypeInformation(r.resourceType,r.cloudName).then((function(n){o.isPending()&&e.resolve(n)})).catch((function(n){o.isPending()&&(++y<bt?Q.delay(5e3).then((function(){o.isPending()&&c()})):e.reject(n))}))};c();this._assetInfoPromise.then((function(n){u._baseAssetTypeInfo=n.base;h(n.base);var t=i.clone(n.associated);t.push(n.base);n.associated.length&&(u._resourceFilter.showTypeFilter(!0),u._resourceFilter.assetTypes(t));n.associated.forEach((function(n){h(n)}))}));this._supplementalDataLoadedTelemetryMarker=r.supplementalDataLoadedMarker;this.groupByItems([{text:s.GroupBy.noGrouping,value:""},{text:s.GroupBy.resourceGroup,value:"resourceGroup"},{text:s.GroupBy.assetType,value:"assetType"},{text:s.GroupBy.subscription,value:"subscription"},{text:s.GroupBy.location,value:"location"}]);this._groupAriaLabelLookup.resourceGroup=s.Aria.Group.resourceGroupDescription;this.
_groupAriaLabelLookup.assetType=s.Aria.Group.assetTypeDescription;this._groupAriaLabelLookup.subscription=s.Aria.Group.subscriptionDescription;this._groupAriaLabelLookup.location=s.Aria.Group.locationDescription;l=b.BulkCommandDefinitions[this._resourceType.toLowerCase()];p.bulkCommandsEnabled&&l&&f.reactor(this._ltm,(function(){u.selectedItemsCount(u._selectedBrowseItems().length)}))}return __extends(t,n),t.prototype._getKindFromAssetType=function(n){var t=this._kindFilter.toLowerCase();return(n.kinds||[]).first((function(n){return n.name.toLowerCase()===t}))},t.prototype._getAssetTypeTitle=function(n){if(this._kindFilter){var t=this._getKindFromAssetType(n);return t&&(t.serviceDisplayName||t.pluralDisplayName)||s.CollectionTitle.kindFilter.format(n.compositeDisplayName.service)}return n.compositeDisplayName.service},t.prototype._fetchData=function(){var u=this._assetTypeInfoMap,t=[],r,n;return i.forEachKey(u,(function(n,i){t.push(i)})),r=new a.ResourcesSource(t),n={sourceHandler:function(t,
i,r,u){var f=function(n){return r.matchSubscription(n)};return(i||[]).forEach((function(t){if(it.isResourceId(t.id)){var i=t;a.showResource(i,n,f)&&u.push(l.toResource(i))}})),u.length<2e3},loading:this.gridViewModel.loading,partialErrors:this._hasErrors,cloudName:this._cloudName,scope:this._scope,kind:this._kindFilter,excludedResourceTypes:this._excludedResourceTypes,filter:this._getSearchString(),selectedSubscriptions:this._resourceFilter.selectedSubscriptions,selectedTypes:this._showTypeFilter()&&this._resourceFilter.selectedTypes(),selectedResourceGroups:this._showResourceGroupFilter()&&this._resourceFilter.selectedResourceGroups(),invertResourceGroupFilter:this._showResourceGroupFilter()&&this._resourceFilter.invertResourceGroupFilter(),selectedLocations:this._resourceFilter.selectedLocations(),telemetry:c.makeResourceManagerTelemetry("GridV2Browse.resource-"+this._baseAssetTypeInfo.assetType)},this._performGetResources(Q(r),n)},t.prototype._makeBrowseItem=function(n){if(it.isResourceId(
n.id))return this._createBrowseResourceItemFromResource(n,this._useAssetTypePreview,this._assetTypeInfoMap,et)},t.prototype.loadData=function(){var n=this,t,r,u;if(this._resourceInstanceMap={},t=this._supplementalColumnsDeferred,this._hasErrors(!1),u=this._assetInfoPromise.then((function(t){var i=t.base,r=i.browseType,o;if(r!==1&&r!==4&&r!==-1){nt.warning(s.unhandledBrowseType+": "+r);n._container.fail(s.unhandledBrowseType);n._hasErrors(!0);return}yt.markAsPreview(n._container,!!i.isPreview);n._useAssetTypePreview=t.associated.some((function(n){return n.isPreview!==i.isPreview}));o=n.assetTypeWithKind=n._getAssetTypeTitle(i);n._titleObservable(o);var u=[i].concat(t.associated),c=u.some((function(n){return n.routingType===g.Tenant||n.routingType===g.ProviderProxy?(n.proxyRoutingFilters||[]).indexOf(1)!==-1:!0})),l=u.some((function(n){return n.routingType===g.Tenant?!1:n.routingType===g.ProviderProxy?(n.proxyRoutingFilters||[]).indexOf(2)!==-1:!0})),a=u.some((function(n){return n.routingType===
g.Tenant||n.routingType===g.ProviderProxy?(n.proxyRoutingFilters||[]).indexOf(3)!==-1:!0})),e=u.some((function(n){return n.routingType!==g.Tenant})),h=it.isSubscriptionId(n._scope);n.groupByItems([{text:s.GroupBy.noGrouping,value:""},e&&(!n._scope||h)?{text:s.GroupBy.resourceGroup,value:"resourceGroup"}:null,{text:s.GroupBy.assetType,value:"assetType"},e&&!n._scope?{text:s.GroupBy.subscription,value:"subscription"}:null,{text:s.GroupBy.location,value:"location"}].filter((function(n){return!!n})));n._showTextFilter(c);n._showSubscriptionFilter(e&&!n._scope);n._showTypeFilter(t.associated&&!!t.associated.length);n._showResourceGroupFilter(l&&(!n._scope||h));n._showLocationFilter(a);n._showTenantLevelSubscriptionSummary(i.routingType===g.Tenant);n._showSubscriptionSummary(!n._scope);n._resourceTypeName=i.compositeDisplayName.lowerPlural;n._initializeCreateListener();n.gridViewModel.columns([w.getNameColumn(),{id:"name",name:f.observable(),format:new pt.Grid2.Formatters.HtmlTemplate({template:"<div class='fx-grid-formatters-svg' style='justify-content: center; opacity: 0.5'><span class='fx-grid-formatters-svgicon' data-bind='image: MsPortalFx.Base.Images.Loading.EllipsisSquare()' style='height: 20px;width: 30px'><\/span><\/div>"}),
width:f.observable("600px"),hiddenInCollapsed:!0,sortable:!1}]);n.gridViewModel.ariaLabel(s.Aria.resourceDescription.format(i.compositeDisplayName.lowerPlural))})).then((function(){var t=n._resourceFilter.subscriptionsLoaded;t.fxOnceAndRun(n._ltm,(function(){n._createFilteringComputed();n._fetchData()}),(function(n){return!!n}))})),this._setContentState(),!this._hasErrors())return this._assetInfoPromise.then((function(u){var l=u.associated.length>0,s={},o=[],h=[],c=Q(),e=u.base,a=[e.compositeDisplayName.plural];return rt.assetTypeInformationSupportsContract(e,2)&&(c=Q(y.getAssetTypeViewModel(e,n._cloudName)).then((function(t){if(!n._ltm||n._ltm.isDisposed())return Q.reject(ut);n._ltm.registerForDispose(t);var i=t.getBrowseConfigContract();return i.getBrowseConfig()})).then((function(t){var r,c,v,p,w,b;return t||nt.warning("browseConfig for resource type {0} is returning null or undefined. asset: {1}, extension: {2}".format(n._resourceType,e.assetType,e.extensionName)),r=t.infoBox,r&&(c=void 0,r.uri?
c=new ht.InfoBox.LinkViewModel(n._container,{image:f.observable(r.image),text:f.observable(r.text),clickableLink:f.observable(tt.Part.createClickableLinkViewModel(f.observable(r.uri)))}):(c=new ht.InfoBox.ViewModel(n._container,!1),c.image=f.observable(r.image),c.text=f.observable(r.text),v=r.blade,v&&(c.selectable=tt.Part.createSelectableViewModel(),c.selectable.selectedValue(tt.getBladeSelection(v.extension,v.detailBlade,v.detailBladeInputs)),n._container.registerSelectable(n._container.createChildLifetime(),"infoBox",c.selectable))),n._infoBox(c)),p=t.contextMenu,n._commandGroup[e.lowerCaseResourceType]=p?p.commandGroup:null,n._commandGroupOwner[e.lowerCaseResourceType]=p?p.commandGroupOwner||e.extensionName:null,w=t.columns||[],w.forEach((function(n){s[n.id]=[e.compositeDisplayName.lowerPlural]})),o=w,h=t.defaultColumns,l&&(h.remove(11),h.unshift(11)),b=[],u.associated.forEach((function(t){if(a.push(t.compositeDisplayName.plural),rt.assetTypeInformationSupportsContract(t,2)){var r=Q(y.
getAssetTypeViewModel(t,n._cloudName)).then((function(t){if(!n._ltm||n._ltm.isDisposed())return Q.reject(ut);n._ltm.registerForDispose(t);var i=t.getBrowseConfigContract();return i.getBrowseConfig()})).then((function(r){var f,u;r||nt.warning("browseConfig for resource type {0} is returning null or undefined. asset: {1}, extension: {2}".format(n._resourceType,t.assetType,t.extensionName));f=r.columns||[];f.forEach((function(n){var t=n.id,i=e.compositeDisplayName.lowerPlural;s[t]?s[t].push(i):s[t]=[i]}));o=i.pushUnique(o,f,(function(n,t){return n.name().toLowerCase()===t.name().toLowerCase()}));u=r.contextMenu;n._commandGroup[t.lowerCaseResourceType]=u?u.commandGroup:null;n._commandGroupOwner[t.lowerCaseResourceType]=u?u.commandGroupOwner||t.extensionName:null})).catch((function(n){if(n!==ut)return Q.reject(n)}));b.push(r)}})),Q.all(b)})).catch((function(n){if(n!==ut)return Q.reject(n)}))),c.then((function(){var i=n._columnsType=n._baseAssetTypeInfo.resourceType||n._resourceType,u=n._columnsScopeType,f,
s,c;o.length?(n._supplementalColumns(o),t.resolve(o),r=!0,n._defaultVisibleColumns(h),n._setDefaultColumns(i,u,e)):(s=n._baseAssetTypeInfo.routingType===g.Tenant,f=s?n._getTenantResourceColumns():n._getResourceColumns(!n._listScope),n._columnContext.setDefaultBrowseColumns(i,u,f));c=n._columnContext.getVisibleBrowseColumns(i,u);c.subscribeAndRun(n._ltm,(function(t){n._updateColumns(t,i,u,f)}))}))})).then((function(){n._chooseColumnsAllowed(!0);r||t.resolve([])})).catch((function(t){nt.error(t);n._hasErrors(!0);n._setContentState()})),u.catch((function(t){nt.error(t);n._titleObservable(n._resourceType);n._hasErrors(!0);n._setContentState()}))},t.prototype._updateColumns=function(n,t,i,r){var e=this,s=n||r||this._columnContext.getDefaultBrowseColumns(t,i)(),u=[w.getNameColumn()],o=[];s.forEach((function(n){if(n&&n.visible){var t=e._supplementalColumns()&&e._supplementalColumns().first((function(t){return t.id===n.id}));t?(u.push(dt(t)),o.push(t.id)):u.push({id:n.itemKey||n.id,name:f.observable(n.name),
format:n.format,dynamicSelectionProvider:n.dynamicSelectionProvider,activatable:n.activatable,width:f.observable("100px"),hiddenInCollapsed:!0,sortable:!0})}}));this._currentSupplementalColumnIds=o;this.gridViewModel.columns(u);this._fetchSupplementalData(this._navigator.items())},t.prototype.createGridViewModel=function(){var n=this,t;this._navigator=new o(this._ltm,{getId:function(n){return ct(n.id)},getModel:function(n){return n},sourceItems:this._items,groupBy:this.groupBy,compare:w.browseCompare});this._navigator.items.subscribe(this._ltm,(function(t){n._fetchSupplementalData(t)}));t=this._createGridOptions({dataNavigator:this._navigator,selection:{enabled:!0,selectionMode:p.tagsV2Enabled||p.bulkCommandsEnabled&&b.BulkCommandDefinitions[this._resourceType.toLowerCase()]?3:2,selectedIds:this._selectedIds,unselectedIds:this._unselectedIds,selectedAll:this._selectedAll,hiddenInCollapsed:!0,dynamicSelectionProvider:this._buildResourceSelection.bind(this),activationMode:2,commandGroupProvider:
function(t){return kt(n._ltm.createChildLifetime(),t.supplemental).then((function(i){var r,u;return i&&(r=i.contextMenu,r)?[{id:r.commandGroup,owner:r.commandGroupOwner||t.extensionName()}]:(u=(t.resourceType||"").toLowerCase(),[{id:n._commandGroup[u],owner:n._commandGroupOwner[u]}])}))},linkUriProperty:"externalLink",activationContainer:this._container},resizing:{resizeToPercent:f.observable(!0)},sorting:{enabled:!0},grouping:{enabled:!0,groupBy:this.groupBy,getGroupAriaLabel:function(t){return n._groupAriaLabelLookup[n.groupBy()]&&n._groupAriaLabelLookup[n.groupBy()].format(t)}},getRowAriaLabel:function(t){var i=t.resourceType&&n._assetTypeInfoMap[t.resourceType.toLowerCase()],r=i&&i.compositeDisplayName.lowerSingular||s.AssetTypeNames.AllResource.lowerSingular;return s.Aria.rowDescription.format(t.name,r)}});this.gridViewModel=new e.ViewModel(this._ltm,t);this.gridViewModel.loading(!0);this._isCollapsible&&this.gridViewModel.selection.activatedIds.subscribe(this._ltm,(function(t){var i=
!(t&&t.length);n._needSupplementalData!==i&&(n._needSupplementalData=i,i&&n._navigator&&n._fetchSupplementalData(n._navigator.items()))}))},t.prototype.populateCommandBar=function(){var n=this;this._assetInfoPromise.then((function(t){var r=t.base,i=[],f,u,e,o,s,h;n._allowOperations&&(f=function(t,u){if(t||u){var f=n._createAddResourceButton(n._ltm,r.resourceType,u,t);f&&i.push(f)}},n._kindFilter?(u=n._getKindFromAssetType(r),u&&f(u.marketplaceMenuItemId,u.marketplaceItemId)):f(r.marketplaceMenuItemId,r.marketplaceItemId));i.push(n._createChooseColumnButton());e=n._createRefreshButton();n._allowOperations&&it.isResourceGroupId(n._listScope)?(i.push(n._createDeleteButton(n._listScope),e,n._createMoveButton(n._listScope)),p.tagsV2Enabled&&(i.push(new tt.Toolbars.Separator),i.push(n._createAssignTagsButton())),n._watchResourceGroupScope()):(i.push(e),o=!1,n._allowOperations&&p.tagsV2Enabled&&(i.push(new tt.Toolbars.Separator),i.push(n._createAssignTagsButton()),o=!0),s=b.BulkCommandDefinitions[
n._resourceType.toLowerCase()],p.bulkCommandsEnabled&&s&&(o||i.push(new tt.Toolbars.Separator),h=n._createBulkCommands(s,(function(t){return n._refreshSupplementalData(t)})),i.push.apply(i,h)));n._toolbar.setItems(i)}))},t.prototype._setDefaultColumns=function(n,t,i){var o=this._baseAssetTypeInfo.routingType===g.Tenant,u=o?this._getTenantResourceColumns():this._getResourceColumns(!this._listScope),f,e,r;if(this._supplementalColumns().forEach((function(n){u.push({id:n.id,itemKey:n.itemKey,name:n.name(),visible:!1,format:null,description:ct(n.description)})})),this._defaultVisibleColumns()){for(f=this._defaultVisibleColumns().map((function(n){return w.mapColumnIdToString(n)})),f.indexOf(lt)>=0||i.routingType===g.Tenant||f.push(lt),e=function(n){var t=u.firstIndex((function(t){return t.id===w.mapColumnIdToString(f[n])}));t>=0&&u.splice(0,0,u.splice(t,1)[0])},r=f.length-1;r>=0;r--)e(r);for(r=0;r<u.length;r++)u[r].visible=r<f.length}this._columnContext.setDefaultBrowseColumns(n,t,u)},t.prototype.refresh=
function(n){var t=this;return n&&this._needSupplementalData?this._assetInfoPromise.then((function(){var n=[],r=t._ltm.createChildLifetime();return i.forEachKey(t._assetTypeInfoMap,(function(i){var u=t._assetTypeInfoMap[i],f;rt.assetTypeInformationSupportsContract(u,2)&&(f=Q(y.getAssetTypeViewModel(u,t._cloudName)).then((function(n){if(t._ltm&&!t._ltm.isDisposed()){r.registerForDispose(n);var i=n.getSupplementalDataContract();if(i&&i.refreshCache)return Q(i.refreshCache())}})),n.push(f))})),Q.all(n).finally((function(){if(r.dispose(),t._ltm&&!t._ltm.isDisposed())return t._performRefresh(t._fetchData())}))})):this._performRefresh(this._fetchData())},t.prototype._fetchSupplementalData=function(n){var t=this;n.length&&i.forEachKey(this._assetTypeInfoMap,(function(i){t._fetchSupplementalDataForResourceTypeKey(i,n.filter((function(n){return!n.groupHeader&&n.data().resourceType.toLowerCase()===i})))}))},t.prototype._fetchSupplementalDataForResourceTypeKey=function(n,t){var i=this,r;if((t&&t.length&&(this.
_pendingSupplementalDataRequest[n]=t),!this._activeSupplementalDataRequest[n])&&(r=this._activeSupplementalDataRequest[n]=this._pendingSupplementalDataRequest[n],this._pendingSupplementalDataRequest[n]=null,r)){var e=this._supplementalDataLifetime[n],o=this._supplementalDataLifetime[n]=this._ltm.createChildLifetime(),s=!1,u=[],c=this._currentSupplementalColumnIds,h=this._assetTypeInfoMap[n];Q(rt.assetTypeInformationSupportsContract(h,2)).then((function(n){if(n&&i._needSupplementalData)return i._supplementalColumnsDeferred.promise})).then((function(t){if(u=(t||[]).filter((function(n){return c.indexOf(n.id)!==-1})).map((function(n){return n.id})),u.length)return Q(y.getAssetTypeViewModel(h,i._cloudName)).then((function(t){var e,h,c,l;if(i._supplementalDataLifetime[n].registerForDispose(t),e=t.getSupplementalDataContract(),e&&e.getSupplementalData){for(h=r.map((function(n){return n.data().resourceId})),c=[];h.length;)c.push(h.splice(0,at));return c.reduce((function(t,h){return t.then((function(){var t=
e.supplementalDataStream,c,a;if(!t){nt.warning("Supplemental data stream for "+i._resourceType+" is null or undefined.");return}if(!f.isObservable(t)){nt.warning("Supplemental data stream for "+i._resourceType+" is not an observable.");return}if(l||(c=t().slice(),a=!0,h.forEach((function(n,t){var i=null,u,f;a&&(u=c[t],u&&ft(u.resourceId,n)?i=u:a=!1);i||(i=c.first((function(t){return ft(t.resourceId,n)})));f=r[t];(i||f.data().supplemental()===et)&&f.data().supplemental(i)})),l=t.subscribeArrayAdds(i._supplementalDataLifetime[n],(function(n){var t=r.first((function(t){return ft(t.data().resourceId,n.resourceId)}));t&&t.data().supplemental(n)}))),s=!0,o===i._supplementalDataLifetime[n]&&!o.isDisposed())return Q.delay(wt).then((function(){return Q(e.getSupplementalData(h,u)).catch((function(n){nt.warning(n,1e3)}))}))}))}),Q())}}))})).then((function(){!s&&i._needSupplementalData&&r.forEach((function(n){n.data().supplemental(null)}))})).finally((function(){Q.delay(1e3).then((function(){e&&e.dispose()}));i._supplementalDataLoadedTelemetryMarker&&
(st.endTrace(i._supplementalDataLoadedTelemetryMarker,st.ActionModifier.Complete,{resourceType:i._resourceType,rows:r.length,columns:u}),i._supplementalDataLoadedTelemetryMarker=null);i._activeSupplementalDataRequest[n]=null;i._fetchSupplementalDataForResourceTypeKey(n)}))}},t.prototype._refreshSupplementalData=function(n){var r=this,t=[];return i.forEachKey(this._assetTypeInfoMap,(function(i){var u=r._refreshSupplementalDataForResourceTypeKey(i,n.filter((function(n){return n.resourceType.toLowerCase()===i})));t.push(u)})),Q.all(t)},t.prototype._refreshSupplementalDataForResourceTypeKey=function(n,t){var i=this,r;return t.length?(r=this._assetTypeInfoMap[n],Q(rt.assetTypeInformationSupportsContract(r,2)).then((function(n){if(n&&i._needSupplementalData)return i._supplementalColumnsDeferred.promise})).then((function(n){var e=(n||[]).filter((function(n){return i._currentSupplementalColumnIds.indexOf(n.id)!==-1})).map((function(n){return n.id})),u;if(e.length)return u=i._ltm.createChildLifetime(),Q(y.
getAssetTypeViewModel(r,i._cloudName)).then((function(n){var r,o,s,h;if(u.registerForDispose(n),r=n.getSupplementalDataContract(),r&&r.getSupplementalData){if(o=r.supplementalDataStream,!o){nt.warning("Supplemental data stream for "+i._resourceType+" is null or undefined.");return}if(!f.isObservable(o)){nt.warning("Supplemental data stream for "+i._resourceType+" is not an observable.");return}for(s=t.map((function(n){return n.resourceId})),h=[];s.length;)h.push(s.splice(0,at));return h.reduce((function(n,u){return n.then((function(){return Q(r.getSupplementalData(u,e,!0)).then((function(){if(i._ltm&&!i._ltm.isDisposed()){var n=o().slice();t.forEach((function(t){var i=n.first((function(n){return ft(n.resourceId,t.resourceId)}));i&&t.supplemental(i)}))}})).catch((function(n){nt.warning(n,1001)}))}))}),Q())}})).finally((function(){u.dispose()}))}))):Q()},t})(w.BaseConfiguration);t.BrowseResourceConfiguration=gt}));define("HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/ResourceGroup",["require","exports",
"f","ko","FxInternal/Controls/Grid2/GridB","FxInternal/Data/GroupNavigator","HubsExtension/Browse/BrowseClientStrings","HubsExtension/ResourceMap/ResourceMapClientStrings","HubsExtension/_generated/ExtensionDefinition","HubsExtension/ArmHelpers/ArmApisStartup","HubsExtension/ArmHelpers/Models/ArmResourceGroup","HubsExtension/Browse/BrowseArea","HubsExtension/HubsCommon","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Base"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){"use strict";var y=i.ViewModels,p=y.Services.ResourceTypes,w=r.utils.peekObservable,b=(function(n){function t(t,i){var u=this;n.call(this,t,i);this._allowOperations=i.allowOperations;this.groupByItems([{text:e.GroupBy.noGrouping,value:""},{text:e.GroupBy.subscription,value:"subscription"},{text:e.GroupBy.location,value:"location"}]);this._groupAriaLabelLookup.subscription=e.Aria.Group.subscriptionDescription;this._groupAriaLabelLookup.location=e.Aria.Group.locationDescription;a.bulkCommandsEnabled&&r.reactor(this._ltm,
(function(){u.selectedItemsCount(u._selectedBrowseItems().length)}))}return __extends(t,n),t.prototype._fetchData=function(){var n={sourceHandler:function(t,i,r,u){var f=function(n){return r.matchSubscription(n)};return(i||[]).forEach((function(t){if(p.isResourceGroupId(t.id)){var i=t;l.showResourceGroup(i,n,f)&&u.push(c.toResourceGroup(i))}})),u.length<2e3},loading:this.gridViewModel.loading,partialErrors:this._hasErrors,cloudName:this._cloudName,scope:this._scope,filter:this._getSearchString(),selectedSubscriptions:this._resourceFilter.selectedSubscriptions,selectedLocations:this._resourceFilter.selectedLocations(),telemetry:h.makeResourceManagerTelemetry("GridV2Browse.resourceGroups")};return this._performGetResources(Q(new l.ResourceGroupsSource),n)},t.prototype._makeBrowseItem=function(n){if(p.isResourceGroupId(n.id))return this._createBrowseResourceGroupItemFromResourceGroup(n)},t.prototype.loadData=function(){var n=this,t;return this._resourceTypeName=o.AssetTypeNames.ResourceGroup.
lowerPlural,this._resourceInstanceMap={},t=this._resourceFilter.subscriptionsLoaded,t.fxOnceAndRun(this._ltm,(function(){n._createFilteringComputed();n._fetchData()}),(function(n){return n})),this._initializeCreateListener(),this._chooseColumnsAllowed(!0),Q()},t.prototype.createGridViewModel=function(){var n=this,h,t,i,c;this._navigator=new f(this._ltm,{getId:function(n){return w(n.id)},sourceItems:this._items,groupBy:this.groupBy,compare:v.browseCompare});h=this._createGridOptions({dataNavigator:this._navigator,selection:{dynamicSelectionProvider:function(t,i){var r=n._getResourceGroupSelectionPromise(w(t));return r.then((function(t){n._logActivation(i.id,t)})),r},activationMode:2,selectionMode:a.tagsV2Enabled?3:2,selectedIds:this._selectedIds,unselectedIds:this._unselectedIds,selectedAll:this._selectedAll,hiddenInCollapsed:!0,commandGroupProvider:function(){return Q([{id:s.CommandGroupNames.resourceGroupBrowseCommands}])},activationContainer:this._container},resizing:{resizeToPercent:r.observable(
!0)},sorting:{enabled:!0},grouping:{enabled:!0,groupBy:this.groupBy,getGroupAriaLabel:function(t){return n._groupAriaLabelLookup[n.groupBy()]&&n._groupAriaLabelLookup[n.groupBy()].format(t)}},ariaLabel:e.Aria.resourceGroupsDescription,getRowAriaLabel:function(n){return e.Aria.rowDescription.format(n.name,o.AssetTypeNames.ResourceGroup.lowerSingular)}});this.gridViewModel=new u.ViewModel(this._ltm,h);t=this._columnsType;i=this._columnsScopeType;this._columnContext.setDefaultBrowseColumns(t,i,this._getResourceGroupColumns());c=this._columnContext.getVisibleBrowseColumns(t,i);c.subscribeAndRun(this._ltm,(function(u){var e=u||n._columnContext.getDefaultBrowseColumns(t,i)(),f=[v.getNameColumn()];e.forEach((function(n){n&&n.visible&&f.push({id:n.itemKey||n.id,name:r.observable(n.name),hiddenInCollapsed:!0,format:n.format,width:r.observable("100px"),sortable:!0})}));n.gridViewModel.columns(f)}));this.gridViewModel.loading(!0)},t.prototype.populateCommandBar=function(){var n=[];this._allowOperations&&
n.push(this._createAddResourceButton(this._ltm,this._resourceType,"Microsoft.ResourceGroup"));n.push(this._createChooseColumnButton(),this._createRefreshButton());this._allowOperations&&a.tagsV2Enabled&&(n.push(new y.Toolbars.Separator),n.push(this._createAssignTagsButton()));this._toolbar.setItems(n)},t.prototype.refresh=function(){return this._performRefresh(this._fetchData())},t})(v.BaseConfiguration);t.BrowseResourceGroupConfiguration=b}));define("HubsExtension/BrowseGrid2/BrowseBlades/ViewModels/BrowseBase",["require","exports","f","i","ko","Fx/Controls/Button","Fx/Controls/DropDown","FxInternal/Controls/Grid2/GridB","FxInternal/Data/GroupNavigator","HubsExtension/Browse/BrowseClientStrings","HubsExtension/ResourceMap/ResourceMapClientStrings","HubsExtension/_generated/ExtensionDefinition","HubsExtension/Common/BrowseCuration","HubsExtension/Common/HubsObservables","HubsExtension/ResourceMap/ResourceMapCommon","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/All","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Recent",
"HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/Resource","HubsExtension/BrowseGrid2/BrowseBlades/BrowseConfigurations/ResourceGroup"],(function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){"use strict";function lt(n){return new it.Forms.CheckBox.ViewModel(n,{inlineLabel:!0,label:u.observable(h.showAll),infoBalloonContent:u.observable(h.showAllInfo),defaultValue:u.observable(!1)})}var g=i.Base,ot=g.Diagnostics,ft=g.Images,nt=g.Diagnostics.Telemetry,st=r.Extension.CloudName,it=i.ViewModels,et=it.Toolbars,d=it.Services.ResourceTypes,tt=h.Browse,ht=ot.createLog(n),rt=!i.isFeatureEnabled("decouplesubs"),ct=(function(){function n(n,t){this.vm=new ut(n,t);this.icon=this.vm.icon;this.title=this.vm.title;this.subtitle=this.vm.subtitle;this.contentState=this.vm.contentState;this.contentStateDisplayText=this.vm.contentStateDisplayText}return n.prototype.addResource=function(){this.vm.addResource()},n.prototype.processInputs=function(n,t){return this.vm.processInputs(n,t)},n.prototype.refresh=
function(n){return this.vm.refresh(n)},n})(),ut;t.BrowseBase=ct;ut=(function(){function n(n,t){var r=this,f,c;this.linkIcon=ft.Hyperlink();this.showAdd=u.observable();this._includeHiddenTypes=u.observable();this.title=u.observable();this.subtitle=u.observable();this.scope=u.observable();this.toolbar=new et.Toolbar(n);this.contentState=u.observable(0);this.contentStateDisplayText=u.observable();this.infoBox=u.observable();this.createButton=u.observable();this.isEmptyGrid=u.observable();this.showGroupBy=u.observable(!0);this._container=n;this._columnContext=t;this._gridLifetime=n.createChildLifetime();this._resourceType="";this._primaryDataTelemetryMarker=nt.start({source:l.BladeNames.resources,action:"BrowseGrid2LoadPrimaryData"});this._supplementalDataTelemetryMarker=nt.start({source:l.BladeNames.resources,action:"BrowseGrid2LoadSupplementalData"});f={sourceItems:[],getId:function(n){return n.resourceId}};c=new s(this._gridLifetime,f);this.gridViewModel=u.observable(new o.ViewModel(this.
_gridLifetime,{dataNavigator:c,columns:u.observableArray([{id:"fakeProperty",name:u.observable(h.Columns.Name.title)}])}));this.resourceFilter=new i.Azure.ResourceFilter.ViewModel(n,{actionHandler:this.gridViewModel,showTextFilter:u.observable(!0),showSubscriptionFilter:u.observable(!1),saveSelectedSubs:u.observable(rt),showSubscriptionSummary:u.observable(!1),showTenantLevelSubscriptionSummary:u.observable(!1),textFilterPlaceholder:u.observable(h.browseFilterLabel)});this.groupBy=e.create(n,{items:u.observable([]),suppressDirtyBehavior:!0,ariaLabel:u.observable(h.GroupBy.label)});this.emptyBrowse={icon:u.observable(ft.Polychromatic.ResourceDefault()),text:u.observable(h.NoResources.default),description:u.observable(h.emptyDescription),links:u.observable([]),createButtonText:u.observable(h.CreateResources.default)};this.toolbar=new et.Toolbar(n);this.countMessage=u.observable("");this.showAllCheckBox=u.observable();this.showAllCheckBox.subscribe(n,(function(t){t&&t.value.subscribe(n,(function(
n){r._includeHiddenTypes(n);r.refresh()}))}))}return n.prototype.addResource=function(){this._container.openBladeAsync(this._browseConfig.getAddBlade(),{asSubJourney:!0})},n.prototype.processInputs=function(n,t){var r=this,e=n.resourceType||g.Constants.ResourceTypes.AllResources,o;return(e!==this._resourceType||n.kind!==this._kindFilter)&&(this._resourceType=e,this._kindFilter=n.kind),this._includeHiddenTypes(n.includeHidenTypes||!1),this.resourceFilter.context(l.BladeNames.resources+" "+e),o=st.readFromInputs(n),this._gridLifetime.dispose(),a.getExcludedResourceTypes(o).then((function(s){var a,it,et,yt,pt,wt,st,ct;r._gridLifetime=r._container.createChildLifetime();r.infoBox(null);it=r.resourceFilter;it.cloudName(o);it.selectedSubscriptionId(n.selectedSubscriptionId);et=n.filter;et&&it.filterText(et);var ut=n.scope||n.listScope,ft={columnContext:r._columnContext,cloudName:o,resourceType:e,resourceFilter:it,toolbar:r.toolbar,container:r._container,contentState:r.contentState,contentStateDisplayText:
r.contentStateDisplayText,loadDataTelemetryEventMarker:r._primaryDataTelemetryMarker,scope:ut,listScope:n.listScope,allowOperations:!(t&&t.disallowOperations),onRefresh:t&&t.onRefresh,includeTypes:r._includeHiddenTypes,excludedTypesFromBrowse:s},at=function(n,t){it.showSubscriptionSummary(n);it.showTenantLevelSubscriptionSummary(t)},ot=function(n,t,i,r,u,f,e){it.showSubscriptionFilter(n);it.saveSelectedSubs(t);at(i,r);it.showTypeFilter(u);it.showLocationFilter(f);it.showResourceGroupFilter(e)},vt={title:h.learnMore,uri:window.fx.environment.hubsLinks.emptyBrowseLink},bt=d.isSubscriptionId(ut);switch(e.toLowerCase()){case y.allResourcesTypeKey:a=new p.BrowseAllConfiguration(r._gridLifetime,ft);r.title(h.AssetTypeNames.AllResource.plural);ot(!ut,rt,!ut,!1,!0,!0,!ut||bt);r.emptyBrowse.links([vt]);r.showAllCheckBox(lt(r._container));break;case y.resourceGroupsTypeKey:a=new k.BrowseResourceGroupConfiguration(r._gridLifetime,ft);r.title(c.AssetTypeNames.ResourceGroup.plural);ot(!ut,rt,!ut,!1,
!1,!0,!1);r.emptyBrowse.links([vt]);break;case y.recentResourcesTypeKey:a=new w.BrowseRecentConfiguration(r._gridLifetime,ft);r.title(h.AssetTypeNames.RecentResource.plural);ot(!1,!1,!1,!1,!1,!1,!1);r.showGroupBy(!1);break;default:at(!1,!1);a=new b.BrowseResourceConfiguration(r._gridLifetime,i.extend(ft,{titleObservable:r.title,showTextFilter:it.showTextFilter,showSubscriptionFilter:it.showSubscriptionFilter,saveSelectedSubs:it.saveSelectedSubs,showTypeFilter:it.showTypeFilter,showResourceGroupFilter:it.showResourceGroupFilter,showLocationFilter:it.showLocationFilter,showSubscriptionSummary:it.showSubscriptionSummary,showTenantLevelSubscriptionSummary:it.showTenantLevelSubscriptionSummary,infoBox:r.infoBox,supplementalDataLoadedTelemetryMarker:r._supplementalDataTelemetryMarker,kindFilter:n.kind,isCollapsible:!(t&&t.isNonCollapsible)}))}return a.groupByItems.subscribeAndRun(r._gridLifetime,r.groupBy.items),r.groupBy.value(""),r._browseConfig=a,a.assetTypeInfo.subscribeAndRun(r._container,
(function(n){n&&(r.emptyBrowse.icon(n.icon),r.emptyBrowse.text(h.NoResources.base.format(n.compositeDisplayName.lowerPlural)),n.description&&r.emptyBrowse.description(n.description),n.links&&n.links.length&&r.emptyBrowse.links(n.links),r.emptyBrowse.createButtonText(h.CreateResources.type.format(n.compositeDisplayName.lowerSingular)))})),u.reactor(r._container,(function(){var n=a.itemCount(),t=a.loaded(),i;!t||r.gridViewModel().loading()||n?t&&n>0&&r.isEmptyGrid(!1):(r.isEmptyGrid(!0),!r.createButton()&&a.addSupported&&(i=f.create(r._container,{text:r.emptyBrowse.createButtonText,visible:r.showAdd,onClick:function(){r.addResource()}}),r.createButton(i)),r.showAdd(a.addSupported))})),ut&&(d.isSubscriptionId(ut)?(yt=d.parseSubscriptionDescriptor(ut),r.subtitle(v.getSubscriptionInfo(yt.subscription,o).uniqueDisplayName)):d.isResourceGroupId(ut)?(pt=d.parseResourceGroupDescriptor(ut),r.subtitle(pt.resourceGroup)):d.isResourceId(ut)?(wt=d.parseResourceDescriptor(ut),r.subtitle(wt.resource)):(ht.
error("Unhandled scope type, should be subscription ID, resource group ID or resource ID"),r.scope=undefined),r.scope(ut)),ut||g.Security.getUserInfo().then((function(n){r.scope()||r.subtitle(n.uniqueDirectoryName)})),a.createGridViewModel(),a.gridViewModel.loadingMessage(h.loading),a.populateCommandBar(),r._items=a._items,st=r.gridViewModel,st(a.gridViewModel),st().selection.activatedIds.subscribeArrayDeletes(r._gridLifetime,(function(n){nt.trace({action:"BrowseItemDeactivated",source:l.BladeNames.resources,data:{assetId:u.unwrap(n)}})})),r.groupBy.value.subscribe(r._gridLifetime,(function(n){a.groupBy(n);nt.trace({action:"BrowseGroupByUpdated",source:l.BladeNames.resources+" "+r._resourceType,data:{groupBy:n}})})),u.reactor(r._gridLifetime,(function(){var n=a.selectedItemsCount(),t=a.itemCount(),i=a.moreDataOnServer(),u;u=i&&n?tt.selectedIncompleteCountMessage.format(n,t):i?tt.incompleteCountMessage.format(t):n?tt.selectedCountMessage.format(n,t):tt.countMessage.format(t);r.countMessage(u)})
),ct=a.loadData(),ct&&ct.then((function(){var n=a.assetTypeWithKind;n&&r.emptyBrowse.text(h.NoResources.base.format(n))&&r.emptyBrowse.createButtonText(h.CreateResources.type.format(n))}))}))},n.prototype.refresh=function(n){return this._browseConfig.refresh(n)},n})();t.BrowseViewModel=ut}));define("HubsExtension/_generated/Blades/HubsExtensionBrowseStyles.css",["require","exports"],(function(){"use strict";return".ext-hubs-browse-container{display:-webkit-flex;display:flex;flex-direction:column;height:100%}.ext-hubs-browse-filters{display:-webkit-flex;display:flex;flex-wrap:wrap}.ext-hubs-browse-infobox{-webkit-flex:0 0 auto;flex:0 0 auto;margin-top:15px;padding-bottom:10px}.ext-hubs-browse-resourcefilter{-webkit-flex:1 1 80%;flex:1 1 80%}.ext-hubs-browse-groupBy{-webkit-flex:1 1 20%;flex:1 1 20%}.ext-hubs-browse-align{top:26px}.ext-hubs-browse-section{display:-webkit-flex;display:flex}.ext-hubs-browse-count{-webkit-flex:0 0 auto;flex:0 0 auto;margin-top:5px;padding-right:20px}.ext-hubs-browse-showall{-webkit-flex:0 0 auto;flex:0 0 auto;margin-top:5px}.ext-hubs-browse-grid-parent{-webkit-flex:1 1 auto;flex:1 1 auto;position:relative}.ext-hubs-browse-grid{position:absolute;top:0;bottom:0;left:0;right:0}.ext-hubs-browse-columns-grid{padding:10px 25px 0}.ext-hubs-browse-empty{margin:inherit auto;display:-webkit-flex;display:flex;flex-direction:column;align-items:center;justify-content:center}.ext-hubs-browse-emptytitle{font-size:15px}.ext-hubs-browse-emptytext{text-align:center;max-width:680px;padding-bottom:15px;font-size:12px}.ext-hubs-browse-links{max-width:680px;padding-bottom:17px;font-size:12px;-webkit-flex-wrap:wrap;flex-wrap:wrap}.ext-hubs-browse-link{padding-left:10px}.ext-hubs-browse-svg{width:10px;height:10px;display:inline-block}.ext-hubs-browse-emptyicon{height:100px;width:100px;padding-top:40px;padding-bottom:20px;opacity:.4}.ext-hubs-browse-hidegrid{flex:none;height:60px;position:relative}"})
)